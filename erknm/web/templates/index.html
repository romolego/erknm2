<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERKNM - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .btn-danger:hover {
            background: #e53e3e;
        }
        
        .btn-warning {
            background: #ed8936;
            color: white;
        }
        
        .btn-warning:hover {
            background: #dd6b20;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        
        .status.info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #718096;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        #settings-tab.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        #settings-form {
            display: grid !important;
        }
        
        .logs-subtab {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .database-subtab {
            display: none;
        }

        .database-subtab.active {
            display: block !important;
        }

        .data-work-subtab {
            display: none;
        }

        .data-work-subtab.active {
            display: block !important;
        }
        
        input[type="date"], input[type="time"], input[type="number"], select {
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            padding: 8px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #4a5568;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∞—Ä—Ö–∏–≤–æ–≤ - –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ–ª–µ–π */
        #database-archives table {
            table-layout: fixed;
            min-width: 1000px;
        }
        
        #database-archives th:nth-child(1), #database-archives td:nth-child(1) { width: 60px; min-width: 60px; } /* ID */
        #database-archives th:nth-child(2), #database-archives td:nth-child(2) { width: 100px; min-width: 100px; } /* –¢–∏–ø */
        #database-archives th:nth-child(3), #database-archives td:nth-child(3) { width: 200px; min-width: 150px; word-break: break-word; overflow-wrap: break-word; } /* –ò–º—è —Ñ–∞–π–ª–∞ */
        #database-archives th:nth-child(4), #database-archives td:nth-child(4) { width: 200px; min-width: 150px; word-break: break-word; overflow-wrap: break-word; } /* URL */
        #database-archives th:nth-child(5), #database-archives td:nth-child(5) { width: 150px; min-width: 120px; word-break: break-all; overflow-wrap: break-word; font-family: monospace; font-size: 11px; } /* SHA256 */
        #database-archives th:nth-child(6), #database-archives td:nth-child(6) { width: 100px; min-width: 80px; } /* –†–∞–∑–º–µ—Ä ZIP */
        #database-archives th:nth-child(7), #database-archives td:nth-child(7) { width: 80px; min-width: 60px; } /* –ó–∞–ø–∏—Å–µ–π */
        #database-archives th:nth-child(8), #database-archives td:nth-child(8) { width: 150px; min-width: 130px; } /* –î–∞—Ç–∞ */
        #database-archives th:nth-child(9), #database-archives td:nth-child(9) { width: 120px; min-width: 100px; } /* –°—Ç–∞—Ç—É—Å */
        #database-archives th:nth-child(10), #database-archives td:nth-child(10) { width: auto; min-width: 150px; } /* –î–µ–π—Å—Ç–≤–∏—è */
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" - –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ–ª–µ–π */
        #database-parsed {
            overflow-x: auto;
            max-width: 100%;
        }
        
        #database-parsed table {
            table-layout: fixed;
            min-width: 800px;
        }
        
        #database-parsed th:nth-child(1), #database-parsed td:nth-child(1) { width: 80px; min-width: 60px; } /* ID */
        #database-parsed th:nth-child(2), #database-parsed td:nth-child(2) { width: 100px; min-width: 80px; } /* –¢–∏–ø */
        #database-parsed th:nth-child(3), #database-parsed td:nth-child(3) { width: 200px; min-width: 150px; word-break: break-word; overflow-wrap: break-word; } /* –ö–ª—é—á/GUID */
        #database-parsed th:nth-child(4), #database-parsed td:nth-child(4) { width: 150px; min-width: 120px; } /* –î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏ */
        #database-parsed th:nth-child(5), #database-parsed td:nth-child(5) { width: 250px; min-width: 200px; word-break: break-all; overflow-wrap: break-word; } /* –ê—Ä—Ö–∏–≤ */
        #database-parsed th:nth-child(6), #database-parsed td:nth-child(6) { width: 150px; min-width: 130px; } /* –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ */
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "–û—à–∏–±–∫–∏" - –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ–ª–µ–π */
        #database-errors {
            overflow-x: auto;
            max-width: 100%;
        }
        
        #database-errors table {
            table-layout: fixed;
            min-width: 800px;
        }
        
        #database-errors th:nth-child(1), #database-errors td:nth-child(1) { width: 150px; min-width: 130px; } /* –î–∞—Ç–∞/–í—Ä–µ–º—è */
        #database-errors th:nth-child(2), #database-errors td:nth-child(2) { width: 150px; min-width: 120px; } /* –ö–æ–Ω—Ç–µ–∫—Å—Ç */
        #database-errors th:nth-child(3), #database-errors td:nth-child(3) { width: 100px; min-width: 80px; } /* –£—Ä–æ–≤–µ–Ω—å */
        #database-errors th:nth-child(4), #database-errors td:nth-child(4) { width: auto; min-width: 300px; word-break: break-word; overflow-wrap: break-word; } /* –°–æ–æ–±—â–µ–Ω–∏–µ */
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ XML" - –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ–ª–µ–π */
        #database-xml-contents {
            overflow-x: auto;
            max-width: 100%;
        }
        
        #database-xml-contents table {
            table-layout: fixed;
            min-width: 1000px;
        }
        
        #database-xml-contents th:nth-child(1), #database-xml-contents td:nth-child(1) { width: 80px; min-width: 60px; } /* ID */
        #database-xml-contents th:nth-child(2), #database-xml-contents td:nth-child(2) { width: 100px; min-width: 80px; } /* –¢–∏–ø */
        #database-xml-contents th:nth-child(3), #database-xml-contents td:nth-child(3) { width: 200px; min-width: 150px; word-break: break-word; overflow-wrap: break-word; } /* –ò–º—è —Ñ–∞–π–ª–∞ */
        #database-xml-contents th:nth-child(4), #database-xml-contents td:nth-child(4) { width: 250px; min-width: 200px; word-break: break-all; overflow-wrap: break-word; } /* –ò—Å—Ç–æ—á–Ω–∏–∫ */
        #database-xml-contents th:nth-child(5), #database-xml-contents td:nth-child(5) { width: 100px; min-width: 80px; } /* –†–∞–∑–º–µ—Ä XML */
        #database-xml-contents th:nth-child(6), #database-xml-contents td:nth-child(6) { width: 150px; min-width: 130px; } /* –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ */
        #database-xml-contents th:nth-child(7), #database-xml-contents td:nth-child(7) { width: 120px; min-width: 100px; } /* –°—Ç–∞—Ç—É—Å */
        #database-xml-contents th:nth-child(8), #database-xml-contents td:nth-child(8) { width: auto; min-width: 100px; } /* –î–µ–π—Å—Ç–≤–∏—è */
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        /* Overlay –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü - –Ω–µ —Å–¥–≤–∏–≥–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç */
        .table-loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none !important;
            align-items: center;
            justify-content: center;
            z-index: 10;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }
        
        .table-loading-overlay.active {
            display: flex !important;
            pointer-events: auto;
        }
        
        .table-container {
            position: relative;
            min-height: 200px;
        }
        
        /* –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è .database-subtab —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤—ã—à–µ */
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∂—É—Ä–Ω–∞–ª–∞ - –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        #logs-tab table {
            table-layout: fixed;
        }
        
        #logs-tab th:nth-child(1), #logs-tab td:nth-child(1) { width: 150px; min-width: 130px; } /* –î–∞—Ç–∞/–í—Ä–µ–º—è */
        #logs-tab th:nth-child(2), #logs-tab td:nth-child(2) { width: 150px; min-width: 120px; } /* –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ */
        #logs-tab th:nth-child(3), #logs-tab td:nth-child(3) { width: 100px; min-width: 80px; } /* –£—Ä–æ–≤–µ–Ω—å */
        #logs-tab th:nth-child(4), #logs-tab td:nth-child(4) { width: auto; min-width: 300px; word-break: break-word; overflow-wrap: break-word; } /* –°–æ–æ–±—â–µ–Ω–∏–µ */
        
        #logs-tab td:nth-child(4) {
            max-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }
        
        #logs-tab td:nth-child(4):hover {
            white-space: normal;
            word-break: break-word;
            overflow-wrap: break-word;
            position: relative;
            z-index: 5;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –æ—à–∏–±–æ–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö - –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        #database-errors table {
            table-layout: fixed;
        }
        
        #database-errors th:nth-child(1), #database-errors td:nth-child(1) { width: 150px; min-width: 130px; } /* –î–∞—Ç–∞/–í—Ä–µ–º—è */
        #database-errors th:nth-child(2), #database-errors td:nth-child(2) { width: 150px; min-width: 120px; } /* –ö–æ–Ω—Ç–µ–∫—Å—Ç */
        #database-errors th:nth-child(3), #database-errors td:nth-child(3) { width: 100px; min-width: 80px; } /* –£—Ä–æ–≤–µ–Ω—å */
        #database-errors th:nth-child(4), #database-errors td:nth-child(4) { width: auto; min-width: 300px; word-break: break-word; overflow-wrap: break-word; } /* –°–æ–æ–±—â–µ–Ω–∏–µ */
        
        #database-errors td:nth-child(4) {
            max-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }
        
        #database-errors td:nth-child(4):hover {
            white-space: normal;
            word-break: break-word;
            overflow-wrap: break-word;
            position: relative;
            z-index: 5;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .loading-progress {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: #667eea;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .badge-error {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .badge-warning {
            background: #feebc8;
            color: #7c2d12;
        }
        
        .badge-info {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow: auto;
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 95%;
            width: 1400px;
            max-height: 90vh;
            overflow: auto;
            margin-top: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }
        
        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: #718096;
            background: none;
            border: none;
            padding: 5px 10px;
        }
        
        .modal-close:hover {
            color: #e53e3e;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 15px 0;
        }
        
        .pagination button {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        .pagination .page-input {
            width: 60px;
            padding: 6px;
            text-align: center;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        .pagination .page-info {
            color: #718096;
            font-size: 14px;
            margin-left: 10px;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö */
        .data-table {
            overflow-x: auto;
        }
        
        .data-table table {
            min-width: 100%;
        }
        
        .data-table td {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .data-table td.expandable {
            cursor: pointer;
        }
        
        .data-table td.expandable:hover {
            background: #edf2f7;
        }
        
        .data-table td.expanded {
            white-space: normal;
            word-break: break-all;
        }
        
        /* –°–µ–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ */
        .cleanup-section {
            background: #fff5f5;
            border: 1px solid #fc8181;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .cleanup-section h4 {
            color: #c53030;
            margin-bottom: 15px;
        }
        
        .cleanup-preview {
            background: #fffaf0;
            border: 1px solid #ed8936;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        
        /* –í–∏–¥–∂–µ—Ç –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∞ */
        .runtime-log-widget {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 350px;
            max-width: 500px;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .runtime-log-widget.collapsed {
            max-width: 400px;
        }
        
        .runtime-log-widget.expanded {
            max-width: 800px;
            max-height: 600px;
        }
        
        .runtime-log-widget.minimized {
            min-width: 50px;
            max-width: 50px;
            width: 50px;
            height: 50px;
        }
        
        .runtime-log-widget.minimized .runtime-log-header,
        .runtime-log-widget.minimized .runtime-log-body,
        .runtime-log-widget.minimized .runtime-log-actions {
            display: none;
        }
        
        .runtime-log-minimize-button {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border: none;
            border-radius: 3px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .runtime-log-minimize-button:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .runtime-log-minimized-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .runtime-log-minimized-icon .runtime-log-status-indicator {
            width: 12px;
            height: 12px;
            margin: 0;
        }
        
        .runtime-log-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .runtime-log-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
        }
        
        .runtime-log-status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .runtime-log-status-indicator.idle {
            background: #718096;
        }
        
        .runtime-log-status-indicator.running {
            background: #48bb78;
            animation: pulse 1.5s infinite;
        }
        
        .runtime-log-status-indicator.stopping {
            background: #ed8936;
            animation: pulse 1s infinite;
        }
        
        .runtime-log-status-indicator.error {
            background: #f56565;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .runtime-log-body {
            padding: 12px 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .runtime-log-body.collapsed {
            max-height: 150px;
        }
        
        .runtime-log-current-operation {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            padding: 8px;
            background: #f7fafc;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }
        
        .runtime-log-events {
            margin-top: 10px;
        }
        
        .runtime-log-event {
            padding: 6px 8px;
            margin-bottom: 4px;
            border-radius: 3px;
            font-size: 12px;
            border-left: 2px solid transparent;
        }
        
        .runtime-log-event.INFO {
            background: #f7fafc;
            border-left-color: #4299e1;
        }
        
        .runtime-log-event.WARNING {
            background: #fffaf0;
            border-left-color: #ed8936;
        }
        
        .runtime-log-event.ERROR {
            background: #fff5f5;
            border-left-color: #f56565;
        }
        
        .runtime-log-event-time {
            color: #718096;
            font-size: 11px;
            margin-right: 8px;
        }
        
        .runtime-log-event-message {
            color: #2d3748;
        }
        
        .runtime-log-actions {
            padding: 8px 15px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            background: #f7fafc;
            border-radius: 0 0 8px 8px;
        }
        
        .runtime-log-actions button {
            padding: 4px 12px;
            font-size: 12px;
        }
        
        .runtime-log-search {
            padding: 8px;
            margin-bottom: 10px;
        }
        
        .runtime-log-search input {
            width: 100%;
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- –í–∏–¥–∂–µ—Ç –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∞ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div id="runtime-log-widget" class="runtime-log-widget collapsed" style="display: none;">
        <div class="runtime-log-header" onclick="toggleRuntimeLog()">
            <h4>
                <span id="runtime-log-status-indicator" class="runtime-log-status-indicator idle"></span>
                –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π
            </h4>
            <span id="runtime-log-toggle-icon">‚ñº</span>
        </div>
        <button class="runtime-log-minimize-button" onclick="minimizeRuntimeLog(event)" title="–°–≤–µ—Ä–Ω—É—Ç—å">‚àí</button>
        <div id="runtime-log-body" class="runtime-log-body collapsed">
            <div id="runtime-log-current-operation" class="runtime-log-current-operation">
                –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
            </div>
            <div id="runtime-log-events" class="runtime-log-events">
                <p style="color: #718096; font-size: 12px; margin: 0;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</p>
            </div>
        </div>
        <div class="runtime-log-actions">
            <button class="btn-primary" onclick="clearRuntimeLog(event)" style="padding: 4px 12px; font-size: 12px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn-primary" onclick="toggleRuntimeLog()" style="padding: 4px 12px; font-size: 12px;" id="runtime-log-expand-btn">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</button>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∞ -->
    <div id="runtime-log-minimized" class="runtime-log-minimized-icon" onclick="restoreRuntimeLog()" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 999;">
        <span id="runtime-log-status-indicator-minimized" class="runtime-log-status-indicator idle"></span>
    </div>
    
    <div class="container">
        <h1>ü§ñ ERKNM - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
        
        <div id="status" class="status"></div>
        
        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <h3>–í—Å–µ–≥–æ –∑–∞–ø—É—Å–∫–æ–≤</h3>
                <div class="value" id="total-runs">-</div>
            </div>
            <div class="stat-card">
                <h3>–ù–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="value" id="datasets">-</div>
            </div>
            <div class="stat-card">
                <h3>–ü–ª–∞–Ω–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫</h3>
                <div class="value" id="plans">-</div>
            </div>
            <div class="stat-card">
                <h3>–ü—Ä–æ–≤–µ—Ä–æ–∫</h3>
                <div class="value" id="inspections">-</div>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn-success" onclick="startSync()" id="sync-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é</button>
            <button class="btn-danger" onclick="stopSync()" id="stop-btn" style="display: none;" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ ZIP, —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞, –ø–∞—Ä—Å–∏–Ω–≥ XML, –≤—Å—Ç–∞–≤–∫–∞ –≤ –ë–î">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É</button>
            <button class="btn-warning" onclick="resumeSync()" id="resume-btn" style="display: none;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é</button>
            <button class="btn-primary" onclick="refreshData()">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('runs', event)">–ó–∞–ø—É—Å–∫–∏</button>
            <button class="tab" onclick="showTab('logs', event)">–ñ—É—Ä–Ω–∞–ª</button>
            <button class="tab" onclick="showTab('database', event)">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="tab" onclick="showTab('data-work', event)">–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏</button>
            <button class="tab" onclick="showTab('settings', event)">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ–±–æ—Ç–∞</button>
        </div>
        
        <div id="runs-tab" class="tab-content active">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞—á–∞–ª–æ</th>
                        <th>–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–¢–∏–ø</th>
                        <th>–§–∞–π–ª–æ–≤</th>
                        <th>–ó–∞–ø–∏—Å–µ–π</th>
                        <th>–û—à–∏–±–æ–∫</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="runs-table">
                    <tr><td colspan="9">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="logs-tab" class="tab-content">
            <div style="margin-bottom: 15px; border-bottom: 2px solid #e2e8f0;">
                <button class="tab logs-subtab active" onclick="showLogsSubTab('all')" id="logs-tab-all">–û–±—â–∏–π</button>
                <button class="tab logs-subtab" onclick="showLogsSubTab('list')" id="logs-tab-list">–°–ø–∏—Å–æ–∫ –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö (list.xml)</button>
                <button class="tab logs-subtab" onclick="showLogsSubTab('dataset')" id="logs-tab-dataset">–ù–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö</button>
                <button class="tab logs-subtab" onclick="showLogsSubTab('data')" id="logs-tab-data">–î–∞–Ω–Ω—ã–µ</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞/–í—Ä–µ–º—è</th>
                        <th>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody id="logs-table">
                    <tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="database-tab" class="tab-content">
            <div style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">–§–∏–ª—å—Ç—Ä—ã</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                    <div>
                        <label>–ü–µ—Ä–∏–æ–¥ —Å:</label>
                        <input type="date" id="db-date-from" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                    </div>
                    <div>
                        <label>–ü–µ—Ä–∏–æ–¥ –¥–æ:</label>
                        <input type="date" id="db-date-to" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                    </div>
                    <div>
                        <label>–¢–∏–ø:</label>
                        <select id="db-data-type" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="all">–í—Å–µ</option>
                            <option value="plan">–ü–ª–∞–Ω—ã</option>
                            <option value="inspection">–ü—Ä–æ–≤–µ—Ä–∫–∏</option>
                            <option value="unknown">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ</option>
                        </select>
                    </div>
                    <div>
                        <label>–°—Ç–∞—Ç—É—Å:</label>
                        <select id="db-status" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="all">–í—Å–µ</option>
                            <option value="pending">–û–∂–∏–¥–∞–µ—Ç</option>
                            <option value="downloaded">–°–∫–∞—á–∞–Ω–æ</option>
                            <option value="processed">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</option>
                            <option value="error">–û—à–∏–±–∫–∞</option>
                        </select>
                    </div>
                    <div>
                        <label>–ü–æ–∏—Å–∫:</label>
                        <input type="text" id="db-search" placeholder="–ò–º—è —Ñ–∞–π–ª–∞, URL, SHA256..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="loadDatabase()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    <button class="btn-primary" onclick="resetDatabaseFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                        <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:</label>
                        <select id="db-page-size" onchange="loadDatabase()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="10">10</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="1000">1000</option>
                            <option value="5000">5000</option>
                        </select>
                        <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                        <select id="db-sort-by" onchange="loadDatabase()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="created_at">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</option>
                            <option value="downloaded_at">–î–∞—Ç–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è</option>
                            <option value="processed_at">–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</option>
                            <option value="file_size">–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞</option>
                            <option value="status">–°—Ç–∞—Ç—É—Å</option>
                        </select>
                        <select id="db-sort-order" onchange="loadDatabase()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é ‚Üì</option>
                            <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é ‚Üë</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap;">
                <div style="display: flex; gap: 10px; border-bottom: 2px solid #e2e8f0;">
                    <button class="tab active" onclick="showDatabaseSubTab('archives')" id="db-tab-archives">–ê—Ä—Ö–∏–≤—ã/—Ñ–∞–π–ª—ã</button>
                    <button class="tab" onclick="showDatabaseSubTab('runs')" id="db-tab-runs">–ó–∞–ø—É—Å–∫–∏</button>
                    <button class="tab" onclick="showDatabaseSubTab('errors')" id="db-tab-errors">–û—à–∏–±–∫–∏</button>
                    <button class="tab" onclick="showDatabaseSubTab('parsed')" id="db-tab-parsed">–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="tab" onclick="showDatabaseSubTab('xml-contents')" id="db-tab-xml-contents">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ XML</button>
                </div>
            </div>
            
            <div id="database-archives" class="database-subtab active">
                <div class="table-container" style="position: relative;">
                    <div class="table-loading-overlay" id="database-archives-loading-overlay">
                        <div class="loading"></div>
                        <span id="database-archives-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div style="overflow-x: auto; max-width: 100%;">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–¢–∏–ø</th>
                            <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
                            <th>URL</th>
                            <th>SHA256</th>
                            <th>–†–∞–∑–º–µ—Ä ZIP</th>
                            <th>–ó–∞–ø–∏—Å–µ–π</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="database-archives-table">
                        <tr><td colspan="10">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                    </tbody>
                </table>
                    </div>
                <div id="archives-pagination" class="pagination"></div>
                </div>
            </div>
            
            <div id="database-runs" class="database-subtab">
                <div class="table-container" style="position: relative;">
                    <div class="table-loading-overlay" id="database-runs-loading-overlay">
                        <div class="loading"></div>
                        <span id="database-runs-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ù–∞—á–∞–ª–æ</th>
                            <th>–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–†–µ–∂–∏–º</th>
                            <th>–§–∞–π–ª–æ–≤</th>
                            <th>–ó–∞–ø–∏—Å–µ–π</th>
                            <th>–û—à–∏–±–æ–∫</th>
                        </tr>
                    </thead>
                    <tbody id="database-runs-table">
                        <tr><td colspan="8">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                    </tbody>
                </table>
            </div>
            </div>
            
            <div id="database-errors" class="database-subtab">
                <div class="table-container" style="position: relative;">
                    <div class="table-loading-overlay" id="database-errors-loading-overlay">
                        <div class="loading"></div>
                        <span id="database-errors-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div style="overflow-x: auto; max-width: 100%;">
                        <table>
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞/–í—Ä–µ–º—è</th>
                                    <th>–ö–æ–Ω—Ç–µ–∫—Å—Ç</th>
                                    <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                    <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody id="database-errors-table">
                                <tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" id="errors-pagination" style="text-align: center; padding: 15px;"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div id="errors-debug-info" style="padding: 5px; font-size: 11px;"></div>
                </div>
            </div>
            
            <div id="database-parsed" class="database-subtab">
                <div class="table-container" style="position: relative;">
                    <div class="table-loading-overlay" id="database-parsed-loading-overlay">
                        <div class="loading"></div>
                        <span id="database-parsed-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div style="overflow-x: auto; max-width: 100%;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ö–ª—é—á/GUID</th>
                                    <th>–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</th>
                                    <th>–ê—Ä—Ö–∏–≤</th>
                                    <th>–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</th>
                                </tr>
                            </thead>
                            <tbody id="database-parsed-table">
                                <tr><td colspan="6">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="6" id="parsed-pagination" style="text-align: center; padding: 15px;"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
                
            <div id="database-xml-contents" class="database-subtab">
                <div class="table-container" style="position: relative;">
                    <div class="table-loading-overlay" id="database-xml-contents-loading-overlay">
                        <div class="loading"></div>
                        <span id="database-xml-contents-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div style="overflow-x: auto; max-width: 100%;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
                                    <th>–ò—Å—Ç–æ—á–Ω–∏–∫ (URL/–∞—Ä—Ö–∏–≤)</th>
                                    <th>–†–∞–∑–º–µ—Ä XML</th>
                                    <th>–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="xml-contents-table">
                                <tr><td colspan="8">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="xml-contents-pagination" class="pagination"></div>
                </div>
            </div>
        </div>
        
        <div id="data-work-tab" class="tab-content">
            <div style="margin-bottom: 20px;">
                <div style="border-bottom: 2px solid #e2e8f0; margin-bottom: 20px;">
                    <button class="tab logs-subtab active" onclick="showDataWorkSubTab('data')" id="data-work-tab-data">–î–∞–Ω–Ω—ã–µ</button>
                    <button class="tab logs-subtab" onclick="showDataWorkSubTab('widgets')" id="data-work-tab-widgets">–í–∏–¥–∂–µ—Ç—ã</button>
                </div>
            </div>
            
            <div id="data-work-data" class="data-work-subtab active">
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">–§–∏–ª—å—Ç—Ä—ã</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div>
                            <label>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:</label>
                            <select id="data-work-data-type" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                <option value="all">–í—Å–µ</option>
                                <option value="plan">–ü–ª–∞–Ω—ã –ø—Ä–æ–≤–µ—Ä–æ–∫</option>
                                <option value="inspection">–ü—Ä–æ–≤–µ—Ä–∫–∏</option>
                            </select>
                        </div>
                        <div>
                            <label>–ü–µ—Ä–∏–æ–¥ —Å:</label>
                            <input type="date" id="data-work-date-from" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        </div>
                        <div>
                            <label>–ü–µ—Ä–∏–æ–¥ –¥–æ:</label>
                            <input type="date" id="data-work-date-to" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        </div>
                        <div>
                            <label>–ü–æ–∏—Å–∫:</label>
                            <input type="text" id="data-work-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø–∏—Å—è–º..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="loadDataWorkData()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                        <button class="btn-primary" onclick="resetDataWorkFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        <button class="btn-primary" onclick="loadDataWorkData()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:</label>
                            <select id="data-work-page-size" onchange="loadDataWorkData()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                <option value="25">25</option>
                                <option value="50" selected>50</option>
                                <option value="100">100</option>
                            </select>
                            <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                            <select id="data-work-sort-by" onchange="loadDataWorkData()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                <option value="created_at">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</option>
                                <option value="record_date">–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</option>
                                <option value="id">ID</option>
                                <option value="record_type">–¢–∏–ø</option>
                            </select>
                            <select id="data-work-sort-order" onchange="loadDataWorkData()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                                <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="table-container" style="position: relative;">
                    <div class="table-loading-overlay" id="data-work-data-loading-overlay">
                        <div class="loading"></div>
                        <span id="data-work-data-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div style="overflow-x: auto; max-width: 100%;">
                        <table id="data-work-data-table">
                            <thead>
                                <tr id="data-work-data-table-header">
                                    <th>ID</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</th>
                                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="data-work-data-table-body">
                                <tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="data-work-data-pagination" class="pagination" style="margin-top: 15px;"></div>
                </div>
            </div>
            
            <div id="data-work-widgets" class="data-work-subtab">
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">–§–∏–ª—å—Ç—Ä—ã</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div>
                            <label>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:</label>
                            <select id="data-work-widgets-data-type" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                <option value="all">–í—Å–µ</option>
                                <option value="plan">–ü–ª–∞–Ω—ã –ø—Ä–æ–≤–µ—Ä–æ–∫</option>
                                <option value="inspection">–ü—Ä–æ–≤–µ—Ä–∫–∏</option>
                            </select>
                        </div>
                        <div>
                            <label>–ü–µ—Ä–∏–æ–¥ —Å:</label>
                            <input type="date" id="data-work-widgets-date-from" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        </div>
                        <div>
                            <label>–ü–µ—Ä–∏–æ–¥ –¥–æ:</label>
                            <input type="date" id="data-work-widgets-date-to" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-primary" onclick="applyDataWorkWidgetsFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn-primary" onclick="resetDataWorkWidgetsFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="widget-card" style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; background: #f7fafc;">
                        <h4 style="margin-bottom: 10px; color: #4a5568;">–ü–ª–∞–Ω—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π</h4>
                        <p style="color: #718096; font-size: 14px; margin-bottom: 15px;">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π</p>
                        <div style="padding: 20px; text-align: center; color: #a0aec0;">
                            <p>–í–∏–¥–∂–µ—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                        </div>
                    </div>
                    <div class="widget-card" style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; background: #f7fafc;">
                        <h4 style="margin-bottom: 10px; color: #4a5568;">–ü—Ä–æ–≤–µ—Ä–∫–∏: –∏—Ç–æ–≥–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥</h4>
                        <p style="color: #718096; font-size: 14px; margin-bottom: 15px;">–°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–∞–º –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
                        <div style="padding: 20px; text-align: center; color: #a0aec0;">
                            <p>–í–∏–¥–∂–µ—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                        </div>
                    </div>
                    <div class="widget-card" style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; background: #f7fafc;">
                        <h4 style="margin-bottom: 10px; color: #4a5568;">–°—Ç–∞—Ç—É—Å—ã/—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h4>
                        <p style="color: #718096; font-size: 14px; margin-bottom: 15px;">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</p>
                        <div style="padding: 20px; text-align: center; color: #a0aec0;">
                            <p>–í–∏–¥–∂–µ—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="settings-tab" class="tab-content">
            <div style="max-width: 800px;">
                <h3 style="margin-bottom: 20px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ–±–æ—Ç–∞</h3>
                
                <form id="settings-form" style="display: grid; gap: 20px;">
                    <div>
                        <h4>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫</h4>
                        <div style="display: grid; gap: 10px; margin-top: 10px;">
                            <label>
                                <input type="checkbox" id="schedule_enabled" checked>
                                –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
                            </label>
                            <div>
                                <label>–†–µ–∂–∏–º:</label>
                                <select id="schedule_mode" onchange="updateScheduleFields()" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                                    <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                                    <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                                </select>
                            </div>
                            <div>
                                <label>–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ (HH:MM):</label>
                                <input type="time" id="schedule_time" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                            <div id="schedule-day-of-week-container" style="display: none;">
                                <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</label>
                                <select id="schedule_day_of_week" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="1">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                                    <option value="2">–í—Ç–æ—Ä–Ω–∏–∫</option>
                                    <option value="3">–°—Ä–µ–¥–∞</option>
                                    <option value="4">–ß–µ—Ç–≤–µ—Ä–≥</option>
                                    <option value="5">–ü—è—Ç–Ω–∏—Ü–∞</option>
                                    <option value="6">–°—É–±–±–æ—Ç–∞</option>
                                    <option value="7">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
                                </select>
                            </div>
                            <div id="schedule-day-of-month-container" style="display: none;">
                                <label>–î–µ–Ω—å –º–µ—Å—è—Ü–∞ (1-28, –¥–ª—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ):</label>
                                <input type="number" id="schedule_day_of_month" min="1" max="28" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h4>
                        <div style="display: grid; gap: 10px; margin-top: 10px;">
                            <label>
                                <input type="checkbox" id="operational_log_enabled" checked>
                                –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π: –í–∫–ª/–í—ã–∫–ª
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <h4>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫</h4>
                        <div style="display: grid; gap: 10px; margin-top: 10px;">
                            <div>
                                <label>–î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ:</label>
                                <select id="on_error" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="stop">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</option>
                                    <option value="pause">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</option>
                                    <option value="continue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</option>
                                </select>
                            </div>
                            <div>
                                <label>–ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤:</label>
                                <select id="retry_policy" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="none">–ë–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤</option>
                                    <option value="fixed">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</option>
                                </select>
                            </div>
                            <div>
                                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤:</label>
                                <input type="number" id="retry_count" min="0" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                            <div>
                                <label>–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (—Å–µ–∫):</label>
                                <input type="number" id="retry_delay_seconds" min="0" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h4>
                        <div style="display: grid; gap: 10px; margin-top: 10px;">
                            <div>
                                <label>–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫):</label>
                                <input type="number" id="throttle_seconds" min="0" step="0.1" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                            <label>
                                <input type="checkbox" id="process_only_zip">
                                –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ ZIP (–±–µ–∑ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏)
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <h4>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h4>
                        <div style="display: grid; gap: 10px; margin-top: 10px;">
                            <div>
                                <label>–ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
                                <select id="sync_order" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="old_to_new">–û—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º</option>
                                    <option value="new_to_old">–û—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º</option>
                                </select>
                                <small style="color: #718096; display: block; margin-top: 5px;">
                                    –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å–ø–∏—Å–∫—É –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞
                                </small>
                            </div>
                            <div>
                                <label>
                                    <input type="checkbox" id="stop_on_repeats_enabled" onchange="updateStopOnRepeatsFields()">
                                    –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏ N –ø–æ–¥—Ä—è–¥ –ø–æ–≤—Ç–æ—Ä–∞—Ö (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ)
                                </label>
                                <div id="stop_on_repeats_count_container" style="margin-top: 10px; display: none;">
                                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ä—è–¥ –∏–¥—É—â–∏—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ (N):</label>
                                    <input type="number" id="stop_on_repeats_count" min="1" value="3" 
                                           style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <small style="color: #718096; display: block; margin-top: 5px;">
                                        –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ N –ø–æ–¥—Ä—è–¥ –∏–¥—É—â–∏—Ö —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</h4>
                        <div style="margin-top: 10px;">
                            <label>–ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤:</label>
                            <select id="unknown_policy" style="width: 100%; padding: 8px; margin-top: 5px;">
                                <option value="skip">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</option>
                                <option value="register_only">–¢–æ–ª—å–∫–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</option>
                                <option value="allow_reclassify">–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                        <button type="button" class="btn-warning" onclick="resetSettings()">–°–±—Ä–æ—Å–∏—Ç—å –∫ –¥–µ—Ñ–æ–ª—Ç–∞–º</button>
                    </div>
                </form>
                
                <div id="settings-status" style="margin-top: 20px;"></div>
                
                <!-- –°–µ–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
                <div class="cleanup-section" style="margin-top: 30px;">
                    <h4>üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h4>
                    <p style="margin-bottom: 15px; color: #718096;">–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. –í–Ω–∏–º–∞–Ω–∏–µ: –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div>
                            <label>–ü–µ—Ä–∏–æ–¥:</label>
                            <select id="cleanup-period" onchange="updateCleanupDates()" style="width: 100%; padding: 8px;">
                                <option value="hour">–ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å</option>
                                <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                                <option value="week">–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è</option>
                                <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                            </select>
                        </div>
                        <div id="cleanup-custom-from" style="display: none;">
                            <label>–°:</label>
                            <input type="datetime-local" id="cleanup-date-from" style="width: 100%; padding: 8px;">
                        </div>
                        <div id="cleanup-custom-to" style="display: none;">
                            <label>–ü–æ:</label>
                            <input type="datetime-local" id="cleanup-date-to" style="width: 100%; padding: 8px;">
                        </div>
                        <div>
                            <label>–ß—Ç–æ —É–¥–∞–ª—è—Ç—å:</label>
                            <select id="cleanup-target" style="width: 100%; padding: 8px;">
                                <option value="runs">–ó–∞–ø—É—Å–∫–∏ –∏ –ª–æ–≥–∏</option>
                                <option value="archives">–ê—Ä—Ö–∏–≤—ã –∏ –¥–∞–Ω–Ω—ã–µ</option>
                                <option value="logs">–¢–æ–ª—å–∫–æ –ª–æ–≥–∏</option>
                                <option value="all">–í—Å—ë</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-warning" onclick="previewCleanup()">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                        <button class="btn-danger" onclick="executeCleanup()" id="cleanup-execute-btn" disabled>–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    
                    <div id="cleanup-preview" class="cleanup-preview" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∞—Ä—Ö–∏–≤–∞ -->
    <div id="data-viewer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="data-viewer-title">–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</h3>
                <button class="modal-close" onclick="closeDataViewer()">&times;</button>
            </div>
            
            <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                <input type="text" id="data-viewer-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –¥–∞–Ω–Ω—ã–º..." 
                       style="flex: 1; min-width: 200px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                <button class="btn-primary" onclick="searchDataViewer()">–ù–∞–π—Ç–∏</button>
                <select id="data-viewer-page-size" onchange="loadArchiveRecords(currentArchiveId)" style="padding: 8px;">
                    <option value="25">25</option>
                    <option value="50" selected>50</option>
                    <option value="100">100</option>
                    <option value="500">500</option>
                </select>
            </div>
            
            <div id="data-viewer-content" class="data-table">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
            
            <div id="data-viewer-pagination" class="pagination"></div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏ -->
    <div id="record-detail-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏</h3>
                <button class="modal-close" onclick="closeRecordDetail()">&times;</button>
            </div>
            <div id="record-detail-content">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ XML -->
    <div id="xml-viewer-modal" class="modal">
        <div class="modal-content" style="max-width: 1400px; width: 95%; max-height: 90vh;">
            <div class="modal-header">
                <h3 id="xml-viewer-title">–ü—Ä–æ—Å–º–æ—Ç—Ä XML</h3>
                <button class="modal-close" onclick="closeXmlViewer()">&times;</button>
            </div>
            
            <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <div style="display: flex; gap: 5px;">
                    <button class="btn-primary" onclick="setXmlViewMode('raw')" id="xml-view-mode-raw">Raw XML</button>
                    <button class="btn-primary" onclick="setXmlViewMode('tree')" id="xml-view-mode-tree">–î–µ—Ä–µ–≤–æ</button>
                    <button class="btn-primary" onclick="setXmlViewMode('table')" id="xml-view-mode-table">–¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª–µ–π</button>
                </div>
                <input type="text" id="xml-viewer-search" placeholder="–ü–æ–∏—Å–∫ –≤ XML..." 
                       style="flex: 1; min-width: 200px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;"
                       onkeyup="searchInXml()">
                <button class="btn-primary" onclick="copyXmlContent()" style="padding: 8px 16px;">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <div id="xml-viewer-content" style="max-height: calc(90vh - 150px); overflow: auto; border: 1px solid #e2e8f0; border-radius: 4px; padding: 15px; background: #f7fafc;">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞ -->
    <div id="delete-run-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                <button class="modal-close" onclick="closeDeleteRunModal()">&times;</button>
            </div>
            <div id="delete-run-modal-body" style="padding: 20px 0;">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–ø—É—Å–∫?</p>
                <div id="delete-run-stats" style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
                    <p><strong>–ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li id="delete-archives-count">–ê—Ä—Ö–∏–≤–æ–≤: -</li>
                        <li id="delete-logs-count">–ó–∞–ø–∏—Å–µ–π –ª–æ–≥–∞: -</li>
                        <li id="delete-records-count">–°–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: -</li>
                    </ul>
                    <p style="margin-top: 10px; color: #e53e3e; font-weight: bold;">
                        ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: —Å–∞–º –∑–∞–ø—É—Å–∫ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –ê—Ä—Ö–∏–≤—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±—É–¥—É—Ç –æ—Ç–≤—è–∑–∞–Ω—ã –æ—Ç –∑–∞–ø—É—Å–∫–∞.
                    </p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn-primary" onclick="closeDeleteRunModal()" style="background: #718096;">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-danger" onclick="executeDeleteRun()" id="delete-run-confirm-btn">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –∑–∞–ø—É—Å–∫–∞ -->
    <div id="run-details-modal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 id="run-details-title">–î–µ—Ç–∞–ª–∏ –∑–∞–ø—É—Å–∫–∞</h3>
                <button class="modal-close" onclick="closeRunDetailsModal()">&times;</button>
            </div>
            <div id="run-details-body" style="padding: 20px 0; max-height: calc(90vh - 100px); overflow-y: auto;">
                <div id="run-details-loading" style="text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <p style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div id="run-details-content" style="display: none;">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –∞—Ä—Ö–∏–≤–∞ -->
    <div id="archive-details-modal" class="modal" onclick="if(event.target === this) closeArchiveDetailsModal()">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="archive-details-title">–î–µ—Ç–∞–ª–∏ –∞—Ä—Ö–∏–≤–∞</h3>
                <button class="modal-close" onclick="closeArchiveDetailsModal()">&times;</button>
            </div>
            <div id="archive-details-body" style="padding: 20px 0; max-height: calc(90vh - 100px); overflow-y: auto;">
                <div id="archive-details-loading" style="text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <p style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div id="archive-details-content" style="display: none;">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let refreshInterval;
        let currentDeleteRunId = null;
        let currentRunDetailsId = null;
        
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
        
        function showTab(tabName, event) {
            console.log('showTab –≤—ã–∑–≤–∞–Ω –¥–ª—è:', tabName);
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showTab',message:'showTab –≤—ã–∑–≤–∞–Ω–∞',data:{tabName:tabName},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'B'})}).catch(()=>{});
            // #endregion
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ —É–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => {
                t.classList.remove('active');
                t.style.setProperty('display', 'none', 'important');
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
            if (event && event.target && event.target.classList.contains('tab')) {
                event.target.classList.add('active');
            } else {
                // Fallback: –Ω–∞–π—Ç–∏ –∫–Ω–æ–ø–∫—É –ø–æ —Ç–µ–∫—Å—Ç—É
                const tabLabels = {
                    'runs': '–ó–∞–ø—É—Å–∫–∏',
                    'logs': '–ñ—É—Ä–Ω–∞–ª',
                    'database': '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö',
                    'data-work': '–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏',
                    'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ–±–æ—Ç–∞'
                };
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    if (tab.textContent.trim() === tabLabels[tabName]) {
                        tab.classList.add('active');
                    }
                });
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
            const targetTabId = tabName + '-tab';
            const targetTab = document.getElementById(targetTabId);
            console.log('showTab: –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏', tabName, 'targetTab –Ω–∞–π–¥–µ–Ω:', !!targetTab, 'ID:', targetTabId);
            
            if (targetTab) {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                targetTab.classList.add('active');
                targetTab.style.setProperty('display', 'block', 'important');
                console.log('–í–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞, display —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ block (important)');
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showTab:activated',message:'–í–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞',data:{tabName:tabName,targetTabId:targetTabId,hasActiveClass:targetTab.classList.contains('active')},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'B'})}).catch(()=>{});
                // #endregion
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ computed style
                setTimeout(() => {
                    const computedStyle = window.getComputedStyle(targetTab);
                    const rect = targetTab.getBoundingClientRect();
                    console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏:', {
                        display: computedStyle.display,
                        visibility: computedStyle.visibility,
                        opacity: computedStyle.opacity,
                        width: rect.width,
                        height: rect.height,
                        hasActiveClass: targetTab.classList.contains('active')
                    });
                // #region agent log
                const parentEl = targetTab.parentElement;
                const parentRect = parentEl ? parentEl.getBoundingClientRect() : {width:0,height:0};
                const parentStyle = parentEl ? window.getComputedStyle(parentEl) : {};
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showTab:cssCheck',message:'CSS –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏',data:{tabName:tabName,display:computedStyle.display,visibility:computedStyle.visibility,opacity:computedStyle.opacity,width:rect.width,height:rect.height,isHidden:computedStyle.display==='none'||rect.width===0,parentId:parentEl?parentEl.id:'none',parentClass:parentEl?parentEl.className:'none',parentDisplay:parentStyle.display||'unknown',parentWidth:parentRect.width,parentHeight:parentRect.height,childCount:targetTab.children.length,innerHTML:targetTab.innerHTML.substring(0,100)},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'A,F,G'})}).catch(()=>{});
                // #endregion

                    // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –≤–∏–¥–Ω–æ, –ø—Ä–∏–º–µ–Ω—è–µ–º –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                    if (computedStyle.display === 'none' || rect.width === 0 || rect.height === 0) {
                        console.error('–í–∫–ª–∞–¥–∫–∞ –≤—Å–µ –µ—â–µ —Å–∫—Ä—ã—Ç–∞! –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ...');
                        targetTab.style.setProperty('display', 'block', 'important');
                        targetTab.style.setProperty('visibility', 'visible', 'important');
                        targetTab.style.setProperty('opacity', '1', 'important');
                        targetTab.classList.add('active');
                    }
                }, 10);
            } else {
                console.error('–í–∫–ª–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM:', targetTabId);
                // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –≤—Å–µ tab-content –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                const allTabs = document.querySelectorAll('.tab-content');
                console.error('–í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ .tab-content:', Array.from(allTabs).map(t => t.id));
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'runs') {
                loadRuns();
            } else if (tabName === 'logs') {
                currentLogsStage = 'all';
                showLogsSubTab('all');
            } else if (tabName === 'database') {
                // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥-–≤–∫–ª–∞–¥–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "–ê—Ä—Ö–∏–≤—ã/—Ñ–∞–π–ª—ã")
                if (!currentDatabaseSubTab) {
                    currentDatabaseSubTab = 'archives';
                    showDatabaseSubTab('archives');
                } else {
                    // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞ –¥—Ä—É–≥–∞—è –ø–æ–¥-–≤–∫–ª–∞–¥–∫–∞, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ—ë –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    showDatabaseSubTab(currentDatabaseSubTab);
                }
            } else if (tabName === 'data-work') {
                // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ "–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏" –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥-–≤–∫–ª–∞–¥–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "–î–∞–Ω–Ω—ã–µ")
                if (!currentDataWorkSubTab) {
                    currentDataWorkSubTab = 'data';
                    showDataWorkSubTab('data');
                } else {
                    showDataWorkSubTab(currentDataWorkSubTab);
                }
            } else if (tabName === 'settings') {
                console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∫–ª–∞–¥–∫–∏ settings...');
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è settings
                const settingsTab = document.getElementById('settings-tab');
                if (!settingsTab) {
                    console.error('settings-tab –ù–ï –ù–ê–ô–î–ï–ù–ê –≤ DOM!');
                    return;
                }
                
                console.log('settings-tab –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º...');
                settingsTab.classList.add('active');
                settingsTab.style.setProperty('display', 'block', 'important');
                settingsTab.style.setProperty('visibility', 'visible', 'important');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
                const settingsForm = document.getElementById('settings-form');
                if (settingsForm) {
                    settingsForm.style.setProperty('display', 'grid', 'important');
                    console.log('–§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞–π–¥–µ–Ω–∞ –∏ –ø–æ–∫–∞–∑–∞–Ω–∞');
                } else {
                    console.error('settings-form –ù–ï –ù–ê–ô–î–ï–ù–ê –≤ DOM!');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
                setTimeout(() => {
                    loadSettings();
                }, 50);
                
                // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–µ—Ä–∂–µ–∫
                [100, 200, 500].forEach(delay => {
                    setTimeout(() => {
                        const computedStyle = window.getComputedStyle(settingsTab);
                        const rect = settingsTab.getBoundingClientRect();
                        
                        if (computedStyle.display === 'none' || rect.width === 0) {
                            console.warn(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ ${delay}ms: –≤–∫–ª–∞–¥–∫–∞ –≤—Å–µ –µ—â–µ —Å–∫—Ä—ã—Ç–∞, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º...`);
                            settingsTab.style.setProperty('display', 'block', 'important');
                            settingsTab.style.setProperty('visibility', 'visible', 'important');
                            settingsTab.classList.add('active');
                            
                            // –¢–∞–∫–∂–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                            if (settingsForm) {
                                settingsForm.style.setProperty('display', 'grid', 'important');
                            }
                        } else {
                            console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ ${delay}ms: –≤–∫–ª–∞–¥–∫–∞ –≤–∏–¥–Ω–∞ (${rect.width}x${rect.height})`);
                        }
                    }, delay);
                });
            }
        }
        
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                if (data.error) {
                    showStatus('–û—à–∏–±–∫–∞: ' + data.error, 'error');
                    return;
                }
                
                if (data.success) {
                    document.getElementById('total-runs').textContent = data.stats.total_runs;
                    document.getElementById('datasets').textContent = data.stats.datasets;
                    document.getElementById('plans').textContent = data.stats.plans;
                    document.getElementById('inspections').textContent = data.stats.inspections;
                    
                    const syncBtn = document.getElementById('sync-btn');
                    const stopBtn = document.getElementById('stop-btn');
                    const resumeBtn = document.getElementById('resume-btn');
                    
                    if (data.sync_running) {
                        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–ª–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ runtime status
                        fetch('/api/runtime/status')
                            .then(response => response.json())
                            .then(runtimeData => {
                                if (runtimeData.success) {
                                    const state = runtimeData.state || 'idle';
                                    if (state === 'stopping') {
                                        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è..."
                                        syncBtn.disabled = true;
                                        syncBtn.innerHTML = '<span class="loading"></span> –û—Å—Ç–∞–Ω–æ–≤–∫–∞...';
                                        if (stopBtn) {
                                            stopBtn.disabled = true;
                                            stopBtn.innerHTML = '<span class="loading"></span> –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...';
                                            stopBtn.style.display = 'inline-block';
                                        }
                                        resumeBtn.style.display = 'none';
                                    } else {
                                        // –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
                                        syncBtn.disabled = true;
                                        syncBtn.innerHTML = '<span class="loading"></span> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
                                        if (stopBtn) {
                                            stopBtn.disabled = false;
                                            stopBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                                            stopBtn.style.display = 'inline-block';
                                        }
                                        resumeBtn.style.display = 'none';
                                    }
                                } else {
                                    // Fallback –∫ –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–µ
                                    syncBtn.disabled = true;
                                    syncBtn.innerHTML = '<span class="loading"></span> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
                                    if (stopBtn) {
                                        stopBtn.disabled = false;
                                        stopBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                                        stopBtn.style.display = 'inline-block';
                                    }
                                    resumeBtn.style.display = 'none';
                                }
                            })
                            .catch(() => {
                                // Fallback –∫ –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                                syncBtn.disabled = true;
                                syncBtn.innerHTML = '<span class="loading"></span> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
                                if (stopBtn) {
                                    stopBtn.disabled = false;
                                    stopBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                                    stopBtn.style.display = 'inline-block';
                                }
                                resumeBtn.style.display = 'none';
                            });
                    } else if (data.sync_paused) {
                        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
                        syncBtn.disabled = false;
                        syncBtn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é';
                        if (stopBtn) {
                            stopBtn.style.display = 'none';
                        }
                        resumeBtn.style.display = 'inline-block';
                    } else {
                        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
                        syncBtn.disabled = false;
                        syncBtn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é';
                        if (stopBtn) {
                            stopBtn.style.display = 'none';
                            stopBtn.disabled = false;
                            stopBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                        }
                        resumeBtn.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
                showStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.', 'error');
            }
        }
        
        async function loadRuns() {
            try {
                const response = await fetch('/api/runs?limit=50');
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('runs-table');
                    if (data.runs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9">–ù–µ—Ç –∑–∞–ø—É—Å–∫–æ–≤</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = data.runs.map(run => {
                        const started = new Date(run.started_at).toLocaleString('ru-RU');
                        const finished = run.finished_at ? new Date(run.finished_at).toLocaleString('ru-RU') : '-';
                        let statusClass = 'badge-info';
                        let statusText = run.status;
                        if (run.status === 'completed') statusClass = 'badge-success';
                        else if (run.status === 'error') statusClass = 'badge-error';
                        else if (run.status === 'paused') statusClass = 'badge-warning';
                        else if (run.status === 'stopped' || run.status === 'aborted') statusClass = 'badge-warning';
                        else if (run.status === 'stopping') statusClass = 'badge-info';
                        
                        // –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
                        const statusMap = {
                            'completed': '–∑–∞–≤–µ—Ä—à–µ–Ω',
                            'error': '–æ—à–∏–±–∫–∞',
                            'paused': '–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω',
                            'stopped': '–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω',
                            'aborted': '–ø—Ä–µ—Ä–≤–∞–Ω',
                            'running': '–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è',
                            'stopping': '–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è'
                        };
                        statusText = statusMap[run.status] || run.status;
                        
                        const type = run.is_manual ? '–†—É—á–Ω–æ–π' : '–ê–≤—Ç–æ';
                        
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ –∏–∑ API
                        const filesCount = run.files_count || 0;
                        const recordsCount = run.records_count || 0;
                        const errorsCount = run.errors_count || 0;
                        
                        return `
                            <tr>
                                <td>${run.id}</td>
                                <td>${started}</td>
                                <td>${finished}</td>
                                <td><span class="badge ${statusClass}">${statusText}</span></td>
                                <td>${type}</td>
                                <td>${filesCount}</td>
                                <td>${recordsCount}</td>
                                <td>${errorsCount}</td>
                                <td>
                                    <button onclick="showRunDetails(${run.id})" class="btn-icon" title="–î–µ—Ç–∞–ª–∏" style="background: none; border: none; cursor: pointer; padding: 4px 8px; color: #667eea;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                    <button onclick="confirmDeleteRun(${run.id})" class="btn-icon" title="–£–¥–∞–ª–∏—Ç—å" style="background: none; border: none; cursor: pointer; padding: 4px 8px; color: #f56565;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—É—Å–∫–æ–≤:', error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –∑–∞–ø—É—Å–∫–∞
        async function confirmDeleteRun(runId) {
            currentDeleteRunId = runId;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–ø—É—Å–∫–∞
            try {
                const response = await fetch(`/api/runs/${runId}/details`);
                const data = await response.json();
                
                if (data.success && data.run) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –º–æ–¥–∞–ª–∫–µ
                    document.getElementById('delete-archives-count').textContent = 
                        `–ê—Ä—Ö–∏–≤–æ–≤: ${data.run.files_count || 0} (–±—É–¥—É—Ç –æ—Ç–≤—è–∑–∞–Ω—ã –æ—Ç –∑–∞–ø—É—Å–∫–∞)`;
                    document.getElementById('delete-logs-count').textContent = 
                        `–ó–∞–ø–∏—Å–µ–π –ª–æ–≥–∞: ${data.run.logs_count || 0} (–±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã)`;
                    document.getElementById('delete-records-count').textContent = 
                        `–°–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: ${data.run.records_count || 0} (–æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –ë–î, –æ—Ç–≤—è–∑–∞–Ω—ã –æ—Ç –∞—Ä—Ö–∏–≤–∞)`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
            
            document.getElementById('delete-run-modal').classList.add('active');
        }
        
        function closeDeleteRunModal() {
            document.getElementById('delete-run-modal').classList.remove('active');
            currentDeleteRunId = null;
        }
        
        async function executeDeleteRun() {
            if (!currentDeleteRunId) return;
            
            const confirmBtn = document.getElementById('delete-run-confirm-btn');
            confirmBtn.disabled = true;
            confirmBtn.textContent = '–£–¥–∞–ª–µ–Ω–∏–µ...';
            
            try {
                const response = await fetch(`/api/runs/${currentDeleteRunId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    showStatus('–ó–∞–ø—É—Å–∫ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
                    closeDeleteRunModal();
                    loadRuns(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    showStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞–ø—É—Å–∫–∞
        async function showRunDetails(runId) {
            currentRunDetailsId = runId;
            const modal = document.getElementById('run-details-modal');
            const loading = document.getElementById('run-details-loading');
            const content = document.getElementById('run-details-content');
            
            modal.classList.add('active');
            loading.style.display = 'block';
            content.style.display = 'none';
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const detailsResponse = await fetch(`/api/runs/${runId}/details`);
                const detailsData = await detailsResponse.json();
                
                if (!detailsData.success || !detailsData.run) {
                    throw new Error(detailsData.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏');
                }
                
                const run = detailsData.run;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã
                const filesResponse = await fetch(`/api/runs/${runId}/files?limit=50`);
                const filesData = await filesResponse.json();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—à–∏–±–∫–∏
                const errorsResponse = await fetch(`/api/runs/${runId}/errors?limit=20`);
                const errorsData = await errorsResponse.json();
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                const started = new Date(run.started_at).toLocaleString('ru-RU');
                const finished = run.finished_at ? new Date(run.finished_at).toLocaleString('ru-RU') : '-';
                const duration = run.duration_seconds 
                    ? `${Math.floor(run.duration_seconds / 60)}–º ${Math.floor(run.duration_seconds % 60)}—Å`
                    : '-';
                
                const statusMap = {
                    'completed': '–∑–∞–≤–µ—Ä—à–µ–Ω',
                    'error': '–æ—à–∏–±–∫–∞',
                    'paused': '–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω',
                    'stopped': '–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω',
                    'aborted': '–ø—Ä–µ—Ä–≤–∞–Ω',
                    'running': '–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è',
                    'stopping': '–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è'
                };
                
                let statusClass = 'badge-info';
                if (run.status === 'completed') statusClass = 'badge-success';
                else if (run.status === 'error') statusClass = 'badge-error';
                else if (run.status === 'paused' || run.status === 'stopped' || run.status === 'aborted') statusClass = 'badge-warning';
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º HTML
                let html = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: #f7fafc; padding: 15px; border-radius: 6px;">
                            <h4 style="margin: 0 0 10px 0; color: #4a5568;">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                            <p><strong>ID:</strong> ${run.id}</p>
                            <p><strong>–†–µ–∂–∏–º:</strong> ${run.is_manual ? '–†—É—á–Ω–æ–π' : '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π'}</p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="badge ${statusClass}">${statusMap[run.status] || run.status}</span></p>
                            <p><strong>–ù–∞—á–∞–ª–æ:</strong> ${started}</p>
                            <p><strong>–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:</strong> ${finished}</p>
                            <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${duration}</p>
                            ${run.error_message ? `<p><strong>–û—à–∏–±–∫–∞:</strong> <span style="color: #e53e3e;">${escapeHtml(run.error_message)}</span></p>` : ''}
                        </div>
                        <div style="background: #f7fafc; padding: 15px; border-radius: 6px;">
                            <h4 style="margin: 0 0 10px 0; color: #4a5568;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                            <p><strong>–§–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:</strong> ${run.files_count || 0}</p>
                            <p><strong>–ó–∞–ø–∏—Å–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ:</strong> ${run.records_count || 0}</p>
                            <p><strong>–û—à–∏–±–æ–∫:</strong> ${run.errors_count || 0}</p>
                        </div>
                    </div>
                `;
                
                // –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                if (filesData.success && filesData.files && filesData.files.length > 0) {
                    html += `
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin-bottom: 15px;">–§–∞–π–ª—ã (${filesData.total || filesData.files.length})</h4>
                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 6px;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead style="background: #f7fafc; position: sticky; top: 0;">
                                        <tr>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">URL/–ü—É—Ç—å</th>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">–°—Ç–∞—Ç—É—Å</th>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">–†–∞–∑–º–µ—Ä</th>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">–î–∞—Ç–∞</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;
                    
                    filesData.files.forEach(file => {
                        const fileDate = file.created_at ? new Date(file.created_at).toLocaleString('ru-RU') : '-';
                        const fileSize = file.file_size ? (file.file_size / 1024 / 1024).toFixed(2) + ' –ú–ë' : '-';
                        const statusClass = file.status === 'processed' ? 'badge-success' : 
                                          file.status === 'error' ? 'badge-error' : 'badge-info';
                        html += `
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">
                                    <div style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${escapeHtml(file.url || file.file_path || '')}">
                                        ${escapeHtml(file.url || file.file_path || '-')}
                                    </div>
                                </td>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">
                                    <span class="badge ${statusClass}">${file.status}</span>
                                </td>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${fileSize}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${fileDate}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }
                
                // –°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
                if (errorsData.success && errorsData.errors && errorsData.errors.length > 0) {
                    html += `
                        <div>
                            <h4 style="margin-bottom: 15px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ (${errorsData.errors.length})</h4>
                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 6px;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead style="background: #f7fafc; position: sticky; top: 0;">
                                        <tr>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">–í—Ä–µ–º—è</th>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;
                    
                    errorsData.errors.forEach(error => {
                        const errorDate = error.created_at ? new Date(error.created_at).toLocaleString('ru-RU') : '-';
                        html += `
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${errorDate}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${escapeHtml(error.operation_type)}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; color: #e53e3e;">${escapeHtml(error.message)}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }
                
                content.innerHTML = html;
                loading.style.display = 'none';
                content.style.display = 'block';
                
            } catch (error) {
                loading.innerHTML = `<p style="color: #e53e3e;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π: ${error.message}</p>`;
            }
        }
        
        function closeRunDetailsModal() {
            document.getElementById('run-details-modal').classList.remove('active');
            currentRunDetailsId = null;
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        let currentLogsStage = 'all';
        
        function showLogsSubTab(stage) {
            currentLogsStage = stage;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥-–≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.logs-subtab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`logs-tab-${stage}`).classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∂—É—Ä–Ω–∞–ª —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ stage
            loadLogs();
        }
        
        async function loadLogs() {
            const overlay = document.getElementById('logs-loading-overlay');
            if (overlay) overlay.classList.add('active');
            
            try {
                const url = currentLogsStage === 'all' 
                    ? '/api/logs?limit=100'
                    : `/api/logs?limit=100&stage=${currentLogsStage}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('logs-table');
                    if (data.logs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ</td></tr>';
                        if (overlay) overlay.classList.remove('active');
                        return;
                    }
                    
                    tbody.innerHTML = data.logs.map(log => {
                        const date = new Date(log.created_at).toLocaleString('ru-RU');
                        const levelClass = log.level === 'ERROR' ? 'badge-error' :
                                         log.level === 'WARNING' ? 'badge-warning' : 'badge-info';
                        const message = escapeHtml(log.message || '');
                        
                        return `
                            <tr>
                                <td>${date}</td>
                                <td>${escapeHtml(log.operation_type || '-')}</td>
                                <td><span class="badge ${levelClass}">${escapeHtml(log.level || '-')}</span></td>
                                <td title="${message}">${message}</td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂—É—Ä–Ω–∞–ª–∞:', error);
            } finally {
                if (overlay) overlay.classList.remove('active');
            }
        }
        
        async function initDB() {
            try {
                showStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...', 'info');
                const response = await fetch('/api/init', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showStatus(data.message, 'success');
                    setTimeout(loadStatus, 1000);
                } else {
                    showStatus(data.message, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
            }
        }
        
        async function startSync() {
            try {
                showStatus('–ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...', 'info');
                const response = await fetch('/api/sync/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ manual: true })
                });
                const data = await response.json();
                
                if (data.success) {
                    showStatus(data.message, 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º runtime –ª–æ–≥
                    loadRuntimeStatus();
                    loadRuntimeEvents();
                    setTimeout(() => {
                        loadStatus();
                        loadRuntimeStatus();
                        loadRuntimeEvents();
                    }, 500);
                } else {
                    showStatus(data.message, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + error.message, 'error');
            }
        }
        
        let stopTimeoutId = null;
        let stopCheckInterval = null;
        let forceStopAvailable = false;
        
        async function stopSync() {
            try {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏? –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ—Å–Ω—ë—Ç—Å—è: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ ZIP, —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞, –ø–∞—Ä—Å–∏–Ω–≥ XML, –≤—Å—Ç–∞–≤–∫–∞ –≤ –ë–î.')) {
                    return;
                }
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è..."
                const stopBtn = document.getElementById('stop-btn');
                if (stopBtn) {
                    stopBtn.disabled = true;
                    stopBtn.innerHTML = '<span class="loading"></span> –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...';
                }
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ runtime –ª–æ–≥–∞
                const operationDiv = document.getElementById('runtime-log-current-operation');
                if (operationDiv) {
                    operationDiv.textContent = '–°—Ç–æ–ø –∑–∞–ø—Ä–æ—à–µ–Ω. –ó–∞–≤–µ—Ä—à–∞—é —Ç–µ–∫—É—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏...';
                }
                loadRuntimeStatus(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
                
                showStatus('–ó–∞–ø—Ä–æ—Å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏...', 'info');
                const response = await fetch('/api/sync/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                
                if (data.success) {
                    showStatus(data.message, 'success');
                    forceStopAvailable = false;
                    const syncBtn = document.getElementById('sync-btn');
                    
                    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                    stopCheckInterval = setInterval(async () => {
                        await loadStatus();
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
                        if (syncBtn && !syncBtn.disabled) {
                            clearInterval(stopCheckInterval);
                            stopCheckInterval = null;
                            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - –∫–Ω–æ–ø–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
                            if (stopBtn) {
                                stopBtn.style.display = 'none';
                                stopBtn.disabled = false;
                                stopBtn.innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                            }
                            if (stopTimeoutId) {
                                clearTimeout(stopTimeoutId);
                                stopTimeoutId = null;
                            }
                            forceStopAvailable = false;
                        }
                        loadRuntimeStatus();
                        loadRuntimeEvents();
                    }, 1000);
                    
                    // –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (30 —Å–µ–∫—É–Ω–¥)
                    stopTimeoutId = setTimeout(() => {
                        if (stopCheckInterval) {
                            clearInterval(stopCheckInterval);
                            stopCheckInterval = null;
                        }
                        forceStopAvailable = true;
                        if (stopBtn) {
                            stopBtn.innerHTML = '<span class="loading"></span> –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è... (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ?)';
                            stopBtn.onclick = forceStopSync;
                            stopBtn.title = '–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–ª–∞. –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏';
                        }
                        showStatus('–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –î–æ—Å—Ç—É–ø–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞.', 'warning');
                    }, 30000);
                } else {
                    showStatus(data.message, 'error');
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    if (stopBtn) {
                        stopBtn.disabled = false;
                        stopBtn.innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                    }
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + error.message, 'error');
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
                const stopBtn = document.getElementById('stop-btn');
                if (stopBtn) {
                    stopBtn.disabled = false;
                    stopBtn.innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                }
            }
        }
        
        async function forceStopSync() {
            if (!confirm('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ—Ä–≤—ë—Ç —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞/–æ–±—Ä–∞–±–æ—Ç–∫–∞). –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                return;
            }
            
            try {
                const stopBtn = document.getElementById('stop-btn');
                if (stopBtn) {
                    stopBtn.disabled = true;
                    stopBtn.innerHTML = '<span class="loading"></span> –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞...';
                }
                
                showStatus('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞...', 'warning');
                
                // –í—ã–∑—ã–≤–∞–µ–º API –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                const response = await fetch('/api/sync/force-stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                
                if (data.success) {
                    showStatus('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', 'success');
                    
                    // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    const operationDiv = document.getElementById('runtime-log-current-operation');
                    if (operationDiv) {
                        operationDiv.textContent = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    await loadStatus();
                    loadRuntimeStatus();
                    loadRuntimeEvents();
                    
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                    const syncBtn = document.getElementById('sync-btn');
                    if (syncBtn) syncBtn.disabled = false;
                    if (stopBtn) {
                        stopBtn.style.display = 'none';
                        stopBtn.disabled = false;
                        stopBtn.innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                        stopBtn.onclick = stopSync;
                        stopBtn.title = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ ZIP, —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞, –ø–∞—Ä—Å–∏–Ω–≥ XML, –≤—Å—Ç–∞–≤–∫–∞ –≤ –ë–î';
                    }
                    
                    if (stopTimeoutId) {
                        clearTimeout(stopTimeoutId);
                        stopTimeoutId = null;
                    }
                    if (stopCheckInterval) {
                        clearInterval(stopCheckInterval);
                        stopCheckInterval = null;
                    }
                    forceStopAvailable = false;
                } else {
                    showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                    if (stopBtn) {
                        stopBtn.disabled = false;
                        stopBtn.innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                    }
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + error.message, 'error');
                const stopBtn = document.getElementById('stop-btn');
                if (stopBtn) {
                    stopBtn.disabled = false;
                    stopBtn.innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É';
                }
            }
        }
        
        async function resumeSync() {
            try {
                showStatus('–í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...', 'info');
                const response = await fetch('/api/sync/resume', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                
                if (data.success) {
                    showStatus(data.message, 'success');
                    setTimeout(loadStatus, 1000);
                } else {
                    showStatus(data.message, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }
        
        function refreshData() {
            loadStatus();
            loadRuns();
            loadLogs();
            loadRuntimeStatus();
            loadRuntimeEvents();
            
            // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö", –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–æ–¥-–≤–∫–ª–∞–¥–∫–∏
            const databaseTab = document.getElementById('database-tab');
            if (databaseTab && databaseTab.classList.contains('active')) {
                loadDatabase();
            }
            
            showStatus('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        const fileInput = document.getElementById('file-input');
        if (fileInput) {
            fileInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    showStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...', 'info');
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        showStatus(data.message, 'success');
                        e.target.value = '';
                        loadRuns(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø—É—Å–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                    } else {
                        showStatus(data.message, 'error');
                    }
                } catch (error) {
                    showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                }
            });
        }
        
        // Drag and drop - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —ç–ª–µ–º–µ–Ω—Ç file-input, –Ω–æ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
        
        // ==================== –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" ====================
        
        let currentDatabaseSubTab = 'archives';
        let currentDbOffset = 0;
        let currentDbLimit = 50;
        let currentErrorsOffset = 0; // –î–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
        let currentXmlContentsOffset = 0; // –î–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        let currentXmlContentsLimit = 50;
        
        function showDatabaseSubTab(tabName) {
            console.log('=== showDatabaseSubTab –≤—ã–∑–≤–∞–Ω–∞ —Å tabName:', tabName);
            currentDatabaseSubTab = tabName;
            console.log('currentDatabaseSubTab —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤:', currentDatabaseSubTab);
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≥–ª–∞–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" –∞–∫—Ç–∏–≤–Ω–∞ –∏ –≤–∏–¥–Ω–∞
            const databaseTab = document.getElementById('database-tab');
            if (databaseTab) {
                databaseTab.classList.add('active');
                databaseTab.style.setProperty('display', 'block', 'important');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏, –Ω–æ –ù–ï —Ç—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏–º –ø–æ–∫–∞–∑–∞—Ç—å
            document.querySelectorAll('.database-subtab').forEach(t => {
                const tabId = t.id.replace('database-', '');
                if (tabId !== tabName) {
                    t.classList.remove('active');
                    t.style.setProperty('display', 'none', 'important');
                }
            });
            document.querySelectorAll('[id^="db-tab-"]').forEach(t => t.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–æ–¥–≤–∫–ª–∞–¥–∫—É
            const subTabElement = document.getElementById('database-' + tabName);
            const tabButton = document.getElementById('db-tab-' + tabName);
            
            console.log('subTabElement –Ω–∞–π–¥–µ–Ω:', !!subTabElement, 'ID:', subTabElement?.id);
            console.log('tabButton –Ω–∞–π–¥–µ–Ω:', !!tabButton, 'ID:', tabButton?.id);
            
            if (subTabElement) {
                subTabElement.classList.add('active');
                subTabElement.style.setProperty('display', 'block', 'important');
                subTabElement.style.setProperty('visibility', 'visible', 'important');
                subTabElement.style.setProperty('opacity', '1', 'important');
                console.log('–ü–æ–¥–≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:', subTabElement.id, '–ò–º–µ–µ—Ç –∫–ª–∞—Å—Å active:', subTabElement.classList.contains('active'));
            } else {
                console.error('–ü–æ–¥–≤–∫–ª–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: database-' + tabName);
            }
            
            if (tabButton) {
                tabButton.classList.add('active');
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º offset –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
            currentDbOffset = 0;
            currentXmlContentsOffset = 0;
            currentErrorsOffset = 0;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏
            console.log('–í—ã–∑–æ–≤ loadDatabase() –¥–ª—è –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏:', tabName);
            loadDatabase();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö", –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º "–ê—Ä—Ö–∏–≤—ã/—Ñ–∞–π–ª—ã"
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
            const databaseTab = document.getElementById('database-tab');
            if (databaseTab && databaseTab.classList.contains('active')) {
                showDatabaseSubTab('archives');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –µ—Å–ª–∏ –æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
            const settingsTab = document.getElementById('settings-tab');
            if (settingsTab && settingsTab.classList.contains('active')) {
                console.log('DOMContentLoaded: settings-tab –∞–∫—Ç–∏–≤–Ω–∞, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º...');
                settingsTab.style.setProperty('display', 'block', 'important');
                settingsTab.style.setProperty('visibility', 'visible', 'important');
                
                const settingsForm = document.getElementById('settings-form');
                if (settingsForm) {
                    settingsForm.style.setProperty('display', 'grid', 'important');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                setTimeout(() => {
                    loadSettings();
                }, 100);
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ settings-tab —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –æ–Ω–∞ –º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
            if (settingsTab) {
                console.log('DOMContentLoaded: settings-tab –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å...');
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
                const style = window.getComputedStyle(settingsTab);
                if (style.display === 'none' && !settingsTab.classList.contains('active')) {
                    // –í–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞ –∏ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
                    console.log('settings-tab —Å–∫—Ä—ã—Ç–∞ (–Ω–µ –∞–∫—Ç–∏–≤–Ω–∞) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ');
                } else if (settingsTab.classList.contains('active') && style.display === 'none') {
                    // –í–∫–ª–∞–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞, –Ω–æ —Å–∫—Ä—ã—Ç–∞ - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º
                    console.warn('settings-tab –∞–∫—Ç–∏–≤–Ω–∞ –Ω–æ —Å–∫—Ä—ã—Ç–∞ - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º!');
                    settingsTab.style.setProperty('display', 'block', 'important');
                    settingsTab.style.setProperty('visibility', 'visible', 'important');
                }
            } else {
                console.error('DOMContentLoaded: settings-tab –ù–ï –ù–ê–ô–î–ï–ù–ê –≤ DOM!');
            }
        });
        
        function resetDatabaseFilters() {
            document.getElementById('db-date-from').value = '';
            document.getElementById('db-date-to').value = '';
            document.getElementById('db-data-type').value = 'all';
            document.getElementById('db-status').value = 'all';
            document.getElementById('db-search').value = '';
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º offsets –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫
            currentDbOffset = 0;
            currentErrorsOffset = 0;
            currentXmlContentsOffset = 0;
            loadDatabase();
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function getCurrentDatabaseFilters() {
            const pageSizeEl = document.getElementById('db-page-size');
            const dateFromEl = document.getElementById('db-date-from');
            const dateToEl = document.getElementById('db-date-to');
            const dataTypeEl = document.getElementById('db-data-type');
            const statusEl = document.getElementById('db-status');
            const searchEl = document.getElementById('db-search');
            const sortByEl = document.getElementById('db-sort-by');
            const sortOrderEl = document.getElementById('db-sort-order');
            
            return {
                date_from: dateFromEl?.value || '',
                date_to: dateToEl?.value || '',
                data_type: dataTypeEl?.value || 'all',
                status: statusEl?.value || 'all',
                search: searchEl?.value || '',
                limit: parseInt(pageSizeEl?.value) || 50,
                offset: currentDbOffset,
                sort_by: sortByEl?.value || 'created_at',
                sort_order: sortOrderEl?.value || 'desc'
            };
        }
        
        async function loadDatabase() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
            const pageSizeEl = document.getElementById('db-page-size');
            const dateFromEl = document.getElementById('db-date-from');
            const dateToEl = document.getElementById('db-date-to');
            const dataTypeEl = document.getElementById('db-data-type');
            const statusEl = document.getElementById('db-status');
            const searchEl = document.getElementById('db-search');
            const sortByEl = document.getElementById('db-sort-by');
            const sortOrderEl = document.getElementById('db-sort-order');
            
            if (!pageSizeEl || !dateFromEl || !dateToEl || !dataTypeEl || !statusEl || !searchEl || !sortByEl || !sortOrderEl) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            currentDbLimit = parseInt(pageSizeEl.value) || 50;
            const filters = {
                date_from: dateFromEl.value,
                date_to: dateToEl.value,
                data_type: dataTypeEl.value,
                status: statusEl.value,
                search: searchEl.value,
                limit: currentDbLimit,
                offset: currentDbOffset,
                sort_by: sortByEl.value,
                sort_order: sortOrderEl.value
            };
            
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏:', currentDatabaseSubTab);
            console.log('–§–∏–ª—å—Ç—Ä—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:', filters);
            
            try {
                if (currentDatabaseSubTab === 'archives') {
                    await loadDatabaseArchives(filters);
                } else if (currentDatabaseSubTab === 'runs') {
                    await loadDatabaseRuns(filters);
                } else if (currentDatabaseSubTab === 'errors') {
                    console.log('–í—ã–∑–æ–≤ loadDatabaseErrors —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:', filters);
                    await loadDatabaseErrors(filters);
                } else if (currentDatabaseSubTab === 'parsed') {
                    await loadDatabaseParsed(filters);
                } else if (currentDatabaseSubTab === 'xml-contents') {
                    await loadXmlContents();
                } else {
                    console.warn('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–æ–¥–≤–∫–ª–∞–¥–∫–∞:', currentDatabaseSubTab);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏', currentDatabaseSubTab, ':', error);
            }
        }
        
        // –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ race condition)
        let isDatabaseLoading = {
            archives: false,
            runs: false,
            errors: false,
            parsed: false,
            'xml-contents': false
        };
        
        // Debug —Ä–µ–∂–∏–º (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏: window.debugDatabase = true)
        let debugDatabase = false;
        
        function debugLog(...args) {
            if (debugDatabase || window.debugDatabase) {
                console.log('[DB DEBUG]', ...args);
            }
        }
        
        async function loadDatabaseArchives(filters) {
            debugLog('=== loadDatabaseArchives –≤—ã–∑–≤–∞–Ω–∞ ===');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            const showLoading = !isDatabaseLoading.archives;
            isDatabaseLoading.archives = true;
            
            const overlay = document.getElementById('database-archives-loading-overlay');
            const loadingText = document.getElementById('database-archives-loading-text');
            
            if (showLoading && overlay) {
                overlay.classList.add('active');
                if (loadingText) loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            }
            
            try {
                const params = new URLSearchParams();
                Object.keys(filters).forEach(k => {
                    if (filters[k] !== undefined && filters[k] !== '') {
                        params.append(k, filters[k]);
                    }
                });
                const response = await fetch('/api/db/archives?' + params);
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('database-archives-table');
                    if (data.archives.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: #718096;">–ù–µ—Ç –∞—Ä—Ö–∏–≤–æ–≤ –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º</td></tr>';
                        updateArchivesPagination(0, filters.limit || 50);
                        isDatabaseLoading.archives = false;
                        if (overlay) overlay.classList.remove('active');
                        return;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ –µ—Å—Ç—å total
                    if (data.total !== undefined && loadingText && showLoading) {
                        const loaded = data.archives.length;
                        const total = data.total;
                        const percent = Math.min(100, Math.round((loaded / total) * 100));
                        loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${loaded} –∏–∑ ${total} (${percent}%)`;
                    } else if (loadingText && showLoading) {
                        loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${data.archives.length} –∑–∞–ø–∏—Å–µ–π...`;
                    }
                    
                    tbody.innerHTML = data.archives.map(arch => {
                        const date = arch.downloaded_at ? new Date(arch.downloaded_at).toLocaleString('ru-RU') : '-';
                        const statusClass = arch.status === 'processed' ? 'badge-success' :
                                          arch.status === 'error' ? 'badge-error' :
                                          arch.status === 'downloaded' ? 'badge-info' : 'badge-warning';
                        const sizeMB = arch.file_size ? (arch.file_size / 1024 / 1024).toFixed(2) + ' MB' : '-';
                        const fileName = arch.xml_file_name || (arch.file_path ? arch.file_path.split('/').pop() : '-');
                        const url = arch.url || '-';
                        const sha256 = arch.sha256 || '-';
                        
                        return `
                            <tr>
                                <td>${arch.id}</td>
                                <td>${arch.data_type}</td>
                                <td title="${fileName}">${escapeHtml(fileName)}</td>
                                <td title="${url}">${escapeHtml(url)}</td>
                                <td title="${sha256}">${escapeHtml(sha256)}</td>
                                <td>${sizeMB}</td>
                                <td>${arch.total_records}</td>
                                <td>${date}</td>
                                <td><span class="badge ${statusClass}">${arch.status}</span></td>
                                <td>
                                    ${arch.total_records > 0 ? `<button class="btn-success" onclick="openDataViewer(${arch.id})" style="padding: 4px 8px; font-size: 12px;">–î–∞–Ω–Ω—ã–µ</button>` : ''}
                                    ${arch.status === 'error' ? `<button class="btn-warning" onclick="retryArchive(${arch.id})" style="padding: 4px 8px; font-size: 12px;">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>` : ''}
                                    <button class="btn-primary" onclick="showArchiveDetail(${arch.id})" style="padding: 4px 8px; font-size: 12px;">–î–µ—Ç–∞–ª–∏</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                    
                    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –∞—Ä—Ö–∏–≤–æ–≤
                    updateArchivesPagination(data.total || data.archives.length, filters.limit || 50);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–æ–≤:', error);
                const tbody = document.getElementById('database-archives-table');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="10" style="text-align: center; padding: 40px; color: #e53e3e;">
                                <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div style="font-size: 12px;">${escapeHtml(error.message)}</div>
                            </td>
                        </tr>`;
                }
            } finally {
                isDatabaseLoading.archives = false;
                const overlay = document.getElementById('database-archives-loading-overlay');
                if (overlay) overlay.classList.remove('active');
            }
        }
        
        function updateArchivesPagination(total, pageSize) {
            const paginationContainer = document.getElementById('archives-pagination');
            if (!paginationContainer) return;
            
            const totalPages = Math.ceil(total / pageSize);
            const currentPage = Math.floor(currentDbOffset / pageSize);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = `<span class="page-info">–í—Å–µ–≥–æ: ${total} –∞—Ä—Ö–∏–≤–æ–≤</span>`;
                return;
            }
            
            let html = renderPagination(currentPage, totalPages, pageSize, 'archivesGoToPage');
            html += ` <span class="page-info">–í—Å–µ–≥–æ: ${total} –∞—Ä—Ö–∏–≤–æ–≤</span>`;
            paginationContainer.innerHTML = html;
        }
        
        function archivesGoToPage(page, pageSize) {
            currentDbOffset = page * pageSize;
            currentDbLimit = pageSize;
            loadDatabase();
        }
        
        async function loadDatabaseRuns(filters) {
            debugLog('=== loadDatabaseRuns –≤—ã–∑–≤–∞–Ω–∞ ===');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            const showLoading = !isDatabaseLoading.runs;
            isDatabaseLoading.runs = true;
            
            const overlay = document.getElementById('database-runs-loading-overlay');
            const loadingText = document.getElementById('database-runs-loading-text');
            
            if (showLoading && overlay) {
                overlay.classList.add('active');
                if (loadingText) loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            }
            
            try {
                const params = new URLSearchParams();
                if (filters.date_from) params.append('date_from', filters.date_from);
                if (filters.date_to) params.append('date_to', filters.date_to);
                if (filters.status !== 'all') params.append('status', filters.status);
                if (filters.limit) params.append('limit', filters.limit);
                if (filters.offset) params.append('offset', filters.offset);
                const response = await fetch('/api/db/runs?' + params);
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('database-runs-table');
                    if (data.runs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #718096;">–ù–µ—Ç –∑–∞–ø—É—Å–∫–æ–≤ –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º</td></tr>';
                        isDatabaseLoading.runs = false;
                        if (overlay) overlay.classList.remove('active');
                        return;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ –µ—Å—Ç—å total
                    if (data.total !== undefined && loadingText && showLoading) {
                        const loaded = data.runs.length;
                        const total = data.total;
                        const percent = Math.min(100, Math.round((loaded / total) * 100));
                        loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${loaded} –∏–∑ ${total} (${percent}%)`;
                    } else if (loadingText && showLoading) {
                        loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${data.runs.length} –∑–∞–ø–∏—Å–µ–π...`;
                    }
                    
                    tbody.innerHTML = data.runs.map(run => {
                        const started = run.started_at ? new Date(run.started_at).toLocaleString('ru-RU') : '-';
                        const finished = run.finished_at ? new Date(run.finished_at).toLocaleString('ru-RU') : '-';
                        const statusClass = run.status === 'completed' ? 'badge-success' :
                                          run.status === 'error' ? 'badge-error' :
                                          run.status === 'paused' ? 'badge-warning' : 'badge-info';
                        
                        return `
                            <tr>
                                <td>${run.id}</td>
                                <td>${started}</td>
                                <td>${finished}</td>
                                <td><span class="badge ${statusClass}">${escapeHtml(run.status || '-')}</span></td>
                                <td>${escapeHtml(run.mode || '-')}</td>
                                <td>${run.files_processed || 0}</td>
                                <td>${run.records_loaded || 0}</td>
                                <td>${run.errors_count || 0}</td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—É—Å–∫–æ–≤:', error);
                const tbody = document.getElementById('database-runs-table');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #e53e3e;">
                                <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div style="font-size: 12px;">${escapeHtml(error.message)}</div>
                            </td>
                        </tr>`;
                }
            } finally {
                isDatabaseLoading.runs = false;
                const overlay = document.getElementById('database-runs-loading-overlay');
                if (overlay) overlay.classList.remove('active');
            }
        }
        
        async function loadDatabaseErrors(filters) {
            console.log('=== loadDatabaseErrors –≤—ã–∑–≤–∞–Ω–∞ ===');
            console.log('–§–∏–ª—å—Ç—Ä—ã:', filters);
            debugLog('=== loadDatabaseErrors –≤—ã–∑–≤–∞–Ω–∞ ===');
            debugLog('–§–∏–ª—å—Ç—Ä—ã:', filters);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            const showLoading = !isDatabaseLoading.errors;
            isDatabaseLoading.errors = true;
            
            const overlay = document.getElementById('database-errors-loading-overlay');
            const loadingText = document.getElementById('database-errors-loading-text');
            const tbody = document.getElementById('database-errors-table');
            const subTab = document.getElementById('database-errors');
            
            debugLog('–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã:', {
                overlay: !!overlay,
                loadingText: !!loadingText,
                tbody: !!tbody,
                subTab: !!subTab,
                subTabVisible: subTab?.classList.contains('active')
            });
            
            if (!tbody) {
                console.error('–¢–∞–±–ª–∏—Ü–∞ database-errors-table –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                isDatabaseLoading.errors = false;
                return;
            }
            
            if (!subTab) {
                console.error('–ü–æ–¥–≤–∫–ª–∞–¥–∫–∞ database-errors –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                isDatabaseLoading.errors = false;
                return;
            }
            
            if (showLoading && overlay) {
                overlay.classList.add('active');
                if (loadingText) loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            }
            
            try {
                const params = new URLSearchParams();
                if (filters.date_from) params.append('date_from', filters.date_from);
                if (filters.date_to) params.append('date_to', filters.date_to);
                if (filters.search) params.append('search', filters.search);
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è limit –∏ offset –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                const limit = filters.limit || 50;
                const offset = filters.offset || 0;
                params.append('limit', limit);
                params.append('offset', offset);
                if (filters.sort_by) params.append('sort_by', filters.sort_by);
                if (filters.sort_order) params.append('sort_order', filters.sort_order);
                
                debugLog('–ó–∞–ø—Ä–æ—Å –æ—à–∏–±–æ–∫:', '/api/db/errors?' + params.toString());
                const response = await fetch('/api/db/errors?' + params);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('–û—Ç–≤–µ—Ç API –æ—à–∏–±–æ–∫:', data);
                console.log('–£—Å–ø–µ—Ö:', data.success, '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ (items):', data.items?.length || 0, '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ (errors):', data.errors?.length || 0, 'Total:', data.total);
                debugLog('–û—Ç–≤–µ—Ç API –æ—à–∏–±–æ–∫:', data);
                debugLog('–£—Å–ø–µ—Ö:', data.success, '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫:', (data.errors || data.items)?.length || 0, 'Total:', data.total);
                
                if (data.success) {
                    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: items (–Ω–æ–≤—ã–π) –∏ errors (—Å—Ç–∞—Ä—ã–π)
                    const errors = data.items || data.errors || [];
                    const total = data.total || errors.length;
                    console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:', errors.length, '–∏–∑ total:', total);
                    
                    if (errors.length === 0) {
                        debugLog('–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è. Total:', total);
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 40px; color: #718096;">
                                    <div style="margin-bottom: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>
                                    <div style="font-size: 12px; color: #a0aec0;">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î: ${total}</div>
                                </td>
                            </tr>`;
                        // –û—á–∏—â–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
                        const paginationDiv = document.getElementById('errors-pagination');
                        if (paginationDiv) paginationDiv.innerHTML = '';
                    } else {
                        debugLog('–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ—à–∏–±–æ–∫:', errors.length, '–∑–∞–ø–∏—Å–µ–π –∏–∑', total);
                        const rowsHTML = errors.map(err => {
                            const date = err.created_at ? new Date(err.created_at).toLocaleString('ru-RU') : '-';
                            const context = `Run: ${err.run_id || '-'}${err.archive_id ? ', Archive: ' + err.archive_id : ''}`;
                            const message = escapeHtml(err.message || '');
                            
                            return `
                                <tr>
                                    <td>${date}</td>
                                    <td>${escapeHtml(context)}</td>
                                    <td><span class="badge badge-error">${escapeHtml(err.level || 'ERROR')}</span></td>
                                    <td title="${message}">${message}</td>
                                </tr>
                            `;
                        }).join('');
                        console.log('–û—Ç—Ä–∏—Å–æ–≤–∫–∞ HTML, –¥–ª–∏–Ω–∞ rowsHTML:', rowsHTML.length);
                        tbody.innerHTML = rowsHTML;
                        console.log('HTML –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ tbody. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', tbody.querySelectorAll('tr').length);
                        
                        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º overlay
                        if (overlay) {
                            overlay.classList.remove('active');
                            overlay.style.display = 'none';
                            console.log('Overlay –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã—Ç');
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É
                        const subTabCheck = document.getElementById('database-errors');
                        if (subTabCheck) {
                            const isActive = subTabCheck.classList.contains('active');
                            console.log('–í–∫–ª–∞–¥–∫–∞ database-errors –∏–º–µ–µ—Ç –∫–ª–∞—Å—Å active:', isActive);
                            if (!isActive) {
                                console.warn('–í–∫–ª–∞–¥–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞! –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º...');
                                subTabCheck.classList.add('active');
                                subTabCheck.style.display = 'block';
                                // –¢–∞–∫–∂–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
                                const tabBtn = document.getElementById('db-tab-errors');
                                if (tabBtn) tabBtn.classList.add('active');
                            }
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
                            const computedStyle = window.getComputedStyle(subTabCheck);
                            console.log('Computed display:', computedStyle.display);
                            console.log('Computed visibility:', computedStyle.visibility);
                            console.log('Computed height:', computedStyle.height);
                            console.log('Computed width:', computedStyle.width);
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤–Ω—É—Ç—Ä–∏
                            const table = subTabCheck.querySelector('table');
                            if (table) {
                                const tableStyle = window.getComputedStyle(table);
                                console.log('–¢–∞–±–ª–∏—Ü–∞ display:', tableStyle.display);
                                console.log('–¢–∞–±–ª–∏—Ü–∞ visibility:', tableStyle.visibility);
                                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', table.querySelectorAll('tbody tr').length);
                            }
                        }
                        
                        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
                        const totalPages = Math.ceil(total / limit);
                        const currentPage = Math.floor(offset / limit);
                        const paginationDiv = document.getElementById('errors-pagination');
                        if (paginationDiv) {
                            if (totalPages > 1) {
                                let paginationHTML = renderPagination(currentPage, totalPages, limit, 'errorsGoToPage');
                                paginationHTML += ` <span class="page-info">–í—Å–µ–≥–æ: ${total} –æ—à–∏–±–æ–∫</span>`;
                                paginationDiv.innerHTML = paginationHTML;
                            } else {
                                paginationDiv.innerHTML = `<span class="page-info">–í—Å–µ–≥–æ: ${total} –æ—à–∏–±–æ–∫</span>`;
                            }
                        }
                        
                        debugLog('–û—à–∏–±–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω—ã, —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', tbody.querySelectorAll('tr').length);
                    }
                    
                    // Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    if (debugDatabase || window.debugDatabase) {
                        const debugInfo = document.getElementById('errors-debug-info');
                        if (debugInfo) {
                            debugInfo.innerHTML = `
                                <small style="color: #718096;">
                                    Debug: items=${errors.length}, total=${total}, limit=${limit}, offset=${offset}
                                </small>`;
                        }
                    }
                } else {
                    console.error('API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', data.error);
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 40px; color: #e53e3e;">
                                <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div style="font-size: 12px;">${escapeHtml(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}</div>
                            </td>
                        </tr>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—à–∏–±–æ–∫:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 40px; color: #e53e3e;">
                            <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div style="font-size: 12px;">${escapeHtml(error.message)}</div>
                        </td>
                    </tr>`;
            } finally {
                isDatabaseLoading.errors = false;
                if (overlay) {
                    overlay.classList.remove('active');
                    overlay.style.display = 'none';
                    console.log('Overlay —Å–∫—Ä—ã—Ç –≤ finally –±–ª–æ–∫–µ');
                    debugLog('Overlay —Å–∫—Ä—ã—Ç –¥–ª—è errors');
                }
                
                // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤–∫–ª–∞–¥–∫–∏
                const finalCheck = document.getElementById('database-errors');
                if (finalCheck) {
                    if (!finalCheck.classList.contains('active')) {
                        console.warn('–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –í–∫–ª–∞–¥–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞! –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º...');
                        finalCheck.classList.add('active');
                        finalCheck.style.display = 'block';
                    }
                    const finalStyle = window.getComputedStyle(finalCheck);
                    console.log('–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê - Display:', finalStyle.display, 'Visibility:', finalStyle.visibility);
                }
            }
        }
        
        function errorsGoToPage(page, pageSize) {
            currentErrorsOffset = page * pageSize;
            const filters = getCurrentDatabaseFilters();
            filters.offset = currentErrorsOffset;
            filters.limit = pageSize;
            loadDatabaseErrors(filters);
        }
        
        async function loadDatabaseParsed(filters) {
            debugLog('=== loadDatabaseParsed –≤—ã–∑–≤–∞–Ω–∞ ===');
            debugLog('–§–∏–ª—å—Ç—Ä—ã:', filters);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            const showLoading = !isDatabaseLoading.parsed;
            isDatabaseLoading.parsed = true;
            
            const overlay = document.getElementById('database-parsed-loading-overlay');
            const loadingText = document.getElementById('database-parsed-loading-text');
            const tbody = document.getElementById('database-parsed-table');
            
            if (!tbody) {
                console.error('–¢–∞–±–ª–∏—Ü–∞ database-parsed-table –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                isDatabaseLoading.parsed = false;
                return;
            }
            
            if (showLoading && overlay) {
                overlay.classList.add('active');
                if (loadingText) loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            }
            
            try {
                const params = new URLSearchParams();
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞
                if (filters.date_from) params.append('date_from', filters.date_from);
                if (filters.date_to) params.append('date_to', filters.date_to);
                if (filters.search) params.append('search', filters.search);
                // –¢–∏–ø –∑–∞–ø–∏—Å–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π —Ñ–∏–ª—å—Ç—Ä —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
                const recordType = filters.data_type && filters.data_type !== 'all' ? filters.data_type : 'all';
                if (recordType !== 'all') params.append('record_type', recordType);
                
                const limit = filters.limit || 50;
                const offset = filters.offset || 0;
                params.append('limit', limit);
                params.append('offset', offset);
                if (filters.sort_by) params.append('sort_by', filters.sort_by);
                if (filters.sort_order) params.append('sort_order', filters.sort_order);
                
                debugLog('–ó–∞–ø—Ä–æ—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', '/api/db/parsed-records?' + params.toString());
                const response = await fetch('/api/db/parsed-records?' + params);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                debugLog('–û—Ç–≤–µ—Ç API —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', data);
                
                if (data.success) {
                    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: items (–Ω–æ–≤—ã–π) –∏ records (—Å—Ç–∞—Ä—ã–π)
                    const records = data.items || data.records || [];
                    const total = data.total || records.length;
                    
                    if (records.length === 0) {
                        debugLog('–ù–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. Total:', total);
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: #718096;">
                                    <div style="margin-bottom: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>
                                    <div style="font-size: 12px; color: #a0aec0;">${data.message || '–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î: ' + total}</div>
                                </td>
                            </tr>`;
                        const paginationDiv = document.getElementById('parsed-pagination');
                        if (paginationDiv) paginationDiv.innerHTML = '';
                    } else {
                        debugLog('–û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', records.length, '–∑–∞–ø–∏—Å–µ–π –∏–∑', total);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö "–ö–ª—é—á/GUID" –∏ "–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏"
                    const hasRecordKey = records.some(rec => rec.record_key && rec.record_key !== '-' && rec.record_key.trim());
                    const hasRecordDate = records.some(rec => rec.record_date && rec.record_date !== '-' && rec.record_date);
                    
                    // –í–°–ï–ì–î–ê –¥–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏, –Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∏—Ö —á–µ—Ä–µ–∑ CSS –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
                    tbody.innerHTML = records.map(rec => {
                        const createdDate = rec.created_at ? new Date(rec.created_at).toLocaleString('ru-RU') : '-';
                        const recordDate = rec.record_date ? new Date(rec.record_date).toLocaleString('ru-RU') : '-';
                        const archiveUrl = rec.archive_url || rec.archive_file_path || '-';
                        const archiveUrlDisplay = archiveUrl !== '-' ? escapeHtml(archiveUrl) : '-';
                        const typeBadge = rec.record_type === 'plan' ? 'badge-info' : rec.record_type === 'inspection' ? 'badge-success' : 'badge-warning';
                        const recordKey = rec.record_key ? escapeHtml(rec.record_key) : '-';
                        
                        // –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ 6 –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
                        return `<tr>
                            <td>${rec.id}</td>
                            <td><span class="badge ${typeBadge}">${escapeHtml(rec.record_type || '-')}</span></td>
                            <td title="${recordKey}">${recordKey}</td>
                            <td>${recordDate}</td>
                            <td title="${archiveUrlDisplay}">${archiveUrlDisplay}</td>
                            <td>${createdDate}</td>
                        </tr>`;
                    }).join('');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –ò –≤ —Å—Ç—Ä–æ–∫–∞—Ö
                    const table = tbody.closest('table');
                    if (table) {
                        const headerRow = table.querySelector('thead tr');
                        if (headerRow) {
                            // –ö–æ–ª–æ–Ω–∫–∏: ID(0), –¢–∏–ø(1), –ö–ª—é—á/GUID(2), –î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏(3), –ê—Ä—Ö–∏–≤(4), –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏(5)
                            if (!hasRecordKey) {
                                // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫—É "–ö–ª—é—á/GUID" (–∏–Ω–¥–µ–∫—Å 2)
                                if (headerRow.children[2]) {
                                    headerRow.children[2].style.display = 'none';
                                }
                                tbody.querySelectorAll('tr').forEach(row => {
                                    if (row.children[2]) row.children[2].style.display = 'none';
                                });
                            } else {
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ —Å–∫—Ä—ã—Ç–∞ —Ä–∞–Ω–µ–µ
                                if (headerRow.children[2]) {
                                    headerRow.children[2].style.display = '';
                                }
                                tbody.querySelectorAll('tr').forEach(row => {
                                    if (row.children[2]) row.children[2].style.display = '';
                                });
                            }
                            
                            if (!hasRecordDate) {
                                // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫—É "–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏" (–∏–Ω–¥–µ–∫—Å 3)
                                if (headerRow.children[3]) {
                                    headerRow.children[3].style.display = 'none';
                                }
                                tbody.querySelectorAll('tr').forEach(row => {
                                    if (row.children[3]) row.children[3].style.display = 'none';
                                });
                            } else {
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ —Å–∫—Ä—ã—Ç–∞ —Ä–∞–Ω–µ–µ
                                if (headerRow.children[3]) {
                                    headerRow.children[3].style.display = '';
                                }
                                tbody.querySelectorAll('tr').forEach(row => {
                                    if (row.children[3]) row.children[3].style.display = '';
                                });
                            }
                        }
                    }
                    debugLog('–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω—ã, —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', tbody.querySelectorAll('tr').length);
                    console.log('–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω—ã, —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', tbody.querySelectorAll('tr').length);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É
                    const subTabParsed = document.getElementById('database-parsed');
                    if (subTabParsed) {
                        const isActive = subTabParsed.classList.contains('active');
                        console.log('–í–∫–ª–∞–¥–∫–∞ database-parsed –∏–º–µ–µ—Ç –∫–ª–∞—Å—Å active:', isActive);
                        if (!isActive) {
                            console.warn('–í–∫–ª–∞–¥–∫–∞ parsed –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞! –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º...');
                            subTabParsed.classList.add('active');
                            const tabBtn = document.getElementById('db-tab-parsed');
                            if (tabBtn) tabBtn.classList.add('active');
                        }
                    }
                    
                    // –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è parsed records
                    const totalPages = Math.ceil(total / limit);
                    const currentPage = Math.floor(offset / limit);
                    const paginationDiv = document.getElementById('parsed-pagination');
                    if (paginationDiv) {
                        if (totalPages > 1) {
                            let paginationHTML = renderPagination(currentPage, totalPages, limit, 'parsedGoToPage');
                            paginationHTML += ` <span class="page-info">–í—Å–µ–≥–æ: ${total} –∑–∞–ø–∏—Å–µ–π</span>`;
                            paginationDiv.innerHTML = paginationHTML;
                        } else {
                            paginationDiv.innerHTML = `<span class="page-info">–í—Å–µ–≥–æ: ${total} –∑–∞–ø–∏—Å–µ–π</span>`;
                        }
                    }
                    }
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #e53e3e;">
                                <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div style="font-size: 12px;">${escapeHtml(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}</div>
                            </td>
                        </tr>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #e53e3e;">
                            <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div style="font-size: 12px;">${escapeHtml(error.message)}</div>
                        </td>
                    </tr>`;
            } finally {
                isDatabaseLoading.parsed = false;
                const overlay = document.getElementById('database-parsed-loading-overlay');
                if (overlay) {
                    overlay.classList.remove('active');
                    debugLog('Overlay —Å–∫—Ä—ã—Ç –¥–ª—è parsed');
                }
            }
        }
        
        async function showArchiveDetail(archiveId) {
            const modal = document.getElementById('archive-details-modal');
            const loading = document.getElementById('archive-details-loading');
            const content = document.getElementById('archive-details-content');
            
            modal.classList.add('active');
            loading.style.display = 'block';
            content.style.display = 'none';
            
            try {
                const response = await fetch(`/api/db/archive/${archiveId}`);
                const data = await response.json();
                
                if (data.success) {
                    const arch = data.archive;
                    const fragments = data.fragments || [];
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
                    const createdAt = arch.created_at ? new Date(arch.created_at).toLocaleString('ru-RU') : '-';
                    const downloadedAt = arch.downloaded_at ? new Date(arch.downloaded_at).toLocaleString('ru-RU') : '-';
                    const processedAt = arch.processed_at ? new Date(arch.processed_at).toLocaleString('ru-RU') : '-';
                    
                    // –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                    const sizeMB = arch.file_size ? (arch.file_size / 1024 / 1024).toFixed(2) + ' MB' : '-';
                    
                    // –°—Ç–∞—Ç—É—Å —Å —Ü–≤–µ—Ç–æ–º
                    const statusClass = arch.status === 'processed' ? 'badge-success' :
                                      arch.status === 'error' ? 'badge-error' :
                                      arch.status === 'downloaded' ? 'badge-info' : 'badge-warning';
                    
                    let html = `
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 15px 20px; margin-bottom: 20px;">
                            <strong>ID –∞—Ä—Ö–∏–≤–∞:</strong>
                            <div>#${arch.id}</div>
                            
                            <strong>URL:</strong>
                            <div style="word-break: break-all; font-family: monospace; font-size: 12px;">${escapeHtml(arch.url || '-')}</div>
                            
                            <strong>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:</strong>
                            <div>${escapeHtml(arch.data_type || 'unknown')}</div>
                            
                            <strong>–°—Ç–∞—Ç—É—Å:</strong>
                            <div><span class="badge ${statusClass}">${escapeHtml(arch.status || '-')}</span></div>
                            
                            <strong>–ò–º—è —Ñ–∞–π–ª–∞:</strong>
                            <div style="word-break: break-all;">${escapeHtml(arch.xml_file_name || arch.file_path || '-')}</div>
                            
                            <strong>SHA256:</strong>
                            <div style="word-break: break-all; font-family: monospace; font-size: 11px;">${escapeHtml(arch.sha256_hash || arch.sha256 || '-')}</div>
                            
                            <strong>–†–∞–∑–º–µ—Ä ZIP:</strong>
                            <div>${sizeMB}</div>
                            
                            <strong>–ó–∞–ø–∏—Å–µ–π:</strong>
                            <div>${arch.total_records || 0}</div>
                            
                            <strong>–§—Ä–∞–≥–º–µ–Ω—Ç–æ–≤:</strong>
                            <div>${fragments.length}</div>
                            
                            <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong>
                            <div>${createdAt}</div>
                            
                            <strong>–î–∞—Ç–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</strong>
                            <div>${downloadedAt}</div>
                            
                            <strong>–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</strong>
                            <div>${processedAt}</div>
                    `;
                    
                    if (arch.error_message) {
                        html += `
                            <strong>–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ:</strong>
                            <div style="color: #e53e3e; word-break: break-word;">${escapeHtml(arch.error_message)}</div>
                        `;
                    }
                    
                    html += '</div>';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, –µ—Å–ª–∏ –µ—Å—Ç—å
                    if (fragments.length > 0) {
                        html += `
                            <h4 style="margin-top: 30px; margin-bottom: 15px;">–§—Ä–∞–≥–º–µ–Ω—Ç—ã –∞—Ä—Ö–∏–≤–∞</h4>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                <thead>
                                    <tr>
                                        <th style="padding: 10px; background: #f7fafc; border-bottom: 2px solid #e2e8f0;">ID</th>
                                        <th style="padding: 10px; background: #f7fafc; border-bottom: 2px solid #e2e8f0;">–ò–º—è —Ñ–∞–π–ª–∞</th>
                                        <th style="padding: 10px; background: #f7fafc; border-bottom: 2px solid #e2e8f0;">–¢–∏–ø</th>
                                        <th style="padding: 10px; background: #f7fafc; border-bottom: 2px solid #e2e8f0;">–°—Ç–∞—Ç—É—Å</th>
                                        <th style="padding: 10px; background: #f7fafc; border-bottom: 2px solid #e2e8f0;">–ó–∞–ø–∏—Å–µ–π</th>
                                        <th style="padding: 10px; background: #f7fafc; border-bottom: 2px solid #e2e8f0;">–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        fragments.forEach(frag => {
                            const fragStatusClass = frag.status === 'processed' ? 'badge-success' :
                                                  frag.status === 'error' ? 'badge-error' : 'badge-warning';
                            const fragProcessedAt = frag.processed_at ? new Date(frag.processed_at).toLocaleString('ru-RU') : '-';
                            html += `
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">${frag.id}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; word-break: break-word;">${escapeHtml(frag.file_name || '-')}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">${escapeHtml(frag.data_type || '-')}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;"><span class="badge ${fragStatusClass}">${escapeHtml(frag.status || '-')}</span></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">${frag.records_count || 0}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">${fragProcessedAt}</td>
                                </tr>
                            `;
                        });
                        
                        html += '</tbody></table>';
                    }
                    
                    content.innerHTML = html;
                    loading.style.display = 'none';
                    content.style.display = 'block';
                } else {
                    content.innerHTML = `<p style="color: #e53e3e;">–û—à–∏–±–∫–∞: ${data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏'}</p>`;
                    loading.style.display = 'none';
                    content.style.display = 'block';
                }
            } catch (error) {
                content.innerHTML = `<p style="color: #e53e3e;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</p>`;
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }
        
        function closeArchiveDetailsModal() {
            document.getElementById('archive-details-modal').classList.remove('active');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ ESC –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–µ—Ç–∞–ª–µ–π –∞—Ä—Ö–∏–≤–∞
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const archiveModal = document.getElementById('archive-details-modal');
                if (archiveModal && archiveModal.classList.contains('active')) {
                    closeArchiveDetailsModal();
                }
            }
        });
        
        async function retryArchive(archiveId) {
            if (!confirm('–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —ç—Ç–æ–≥–æ –∞—Ä—Ö–∏–≤–∞?')) return;
            try {
                const response = await fetch(`/api/db/archive/${archiveId}/retry`, { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    showStatus('–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞', 'success');
                    setTimeout(loadDatabase, 1000);
                } else {
                    showStatus(data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }
        
        // ==================== –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏" ====================
        
        let currentDataWorkSubTab = 'data';
        let currentDataWorkOffset = 0;
        let currentDataWorkLimit = 50;
        
        function showDataWorkSubTab(tabName) {
            console.log('showDataWorkSubTab –≤—ã–∑–≤–∞–Ω–∞ —Å:', tabName);
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showDataWorkSubTab',message:'showDataWorkSubTab –≤—ã–∑–≤–∞–Ω–∞',data:{tabName:tabName},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'D,E'})}).catch(()=>{});
            // #endregion
            currentDataWorkSubTab = tabName;

            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≥–ª–∞–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ "–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏" –∞–∫—Ç–∏–≤–Ω–∞
            const dataWorkTab = document.getElementById('data-work-tab');
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showDataWorkSubTab:dataWorkTab',message:'–ü—Ä–æ–≤–µ—Ä–∫–∞ dataWorkTab',data:{found:!!dataWorkTab,hasActiveClass:dataWorkTab?dataWorkTab.classList.contains('active'):false},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'D'})}).catch(()=>{});
            // #endregion
            if (dataWorkTab && !dataWorkTab.classList.contains('active')) {
                dataWorkTab.classList.add('active');
                dataWorkTab.style.setProperty('display', 'block', 'important');
            }

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏, –∫—Ä–æ–º–µ —Ü–µ–ª–µ–≤–æ–π (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å showDatabaseSubTab)
            document.querySelectorAll('.data-work-subtab').forEach(t => {
                const subTabId = t.id.replace('data-work-', '');
                if (subTabId !== tabName) {
                    t.classList.remove('active');
                    t.style.setProperty('display', 'none', 'important');
                }
            });
            document.querySelectorAll('[id^="data-work-tab-"]').forEach(t => t.classList.remove('active'));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–æ–¥–≤–∫–ª–∞–¥–∫—É
            const subTabElement = document.getElementById('data-work-' + tabName);
            const tabButton = document.getElementById('data-work-tab-' + tabName);
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showDataWorkSubTab:subTabElement',message:'–ü—Ä–æ–≤–µ—Ä–∫–∞ subTabElement',data:{subTabId:'data-work-'+tabName,found:!!subTabElement,tabButtonFound:!!tabButton},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'D'})}).catch(()=>{});
            // #endregion

            if (subTabElement) {
                subTabElement.classList.add('active');
                subTabElement.style.setProperty('display', 'block', 'important');
            }
            if (tabButton) {
                tabButton.classList.add('active');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'data') {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:showDataWorkSubTab:beforeLoadData',message:'–í—ã–∑–æ–≤ loadDataWorkData',data:{tabName:tabName},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'E'})}).catch(()=>{});
                // #endregion
                loadDataWorkData();
            }
        }
        
        function getCurrentDataWorkFilters() {
            return {
                record_type: document.getElementById('data-work-data-type')?.value || 'all',
                date_from: document.getElementById('data-work-date-from')?.value || '',
                date_to: document.getElementById('data-work-date-to')?.value || '',
                search: document.getElementById('data-work-search')?.value || '',
                limit: parseInt(document.getElementById('data-work-page-size')?.value || '50'),
                offset: currentDataWorkOffset,
                sort_by: document.getElementById('data-work-sort-by')?.value || 'created_at',
                sort_order: document.getElementById('data-work-sort-order')?.value || 'desc'
            };
        }
        
        function resetDataWorkFilters() {
            document.getElementById('data-work-data-type').value = 'all';
            document.getElementById('data-work-date-from').value = '';
            document.getElementById('data-work-date-to').value = '';
            document.getElementById('data-work-search').value = '';
            document.getElementById('data-work-page-size').value = '50';
            document.getElementById('data-work-sort-by').value = 'created_at';
            document.getElementById('data-work-sort-order').value = 'desc';
            currentDataWorkOffset = 0;
            loadDataWorkData();
        }
        
        async function loadDataWorkData() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadDataWorkData:start',message:'loadDataWorkData –Ω–∞—á–∞—Ç–∞',data:{},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'E'})}).catch(()=>{});
            // #endregion
            const overlay = document.getElementById('data-work-data-loading-overlay');
            const loadingText = document.getElementById('data-work-data-loading-text');
            const tbody = document.getElementById('data-work-data-table-body');
            const table = document.getElementById('data-work-data-table');

            if (!tbody || !table) {
                console.error('–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadDataWorkData:error',message:'–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞',data:{tbodyFound:!!tbody,tableFound:!!table},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'D'})}).catch(()=>{});
                // #endregion
                return;
            }

            if (overlay) overlay.classList.add('active');
            if (loadingText) loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const filters = getCurrentDataWorkFilters();

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const params = new URLSearchParams();
                if (filters.record_type !== 'all') params.append('record_type', filters.record_type);
                if (filters.date_from) params.append('date_from', filters.date_from);
                if (filters.date_to) params.append('date_to', filters.date_to);
                if (filters.search) params.append('search', filters.search);
                params.append('limit', filters.limit);
                params.append('offset', filters.offset);
                params.append('sort_by', filters.sort_by);
                params.append('sort_order', filters.sort_order);

                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadDataWorkData:fetch',message:'–ó–∞–ø—Ä–æ—Å API',data:{url:`/api/db/parsed-records?${params}`},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'C'})}).catch(()=>{});
                // #endregion
                const response = await fetch(`/api/db/parsed-records?${params}`);
                const data = await response.json();
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadDataWorkData:response',message:'–û—Ç–≤–µ—Ç API',data:{success:data.success,itemsCount:data.items?data.items.length:0,total:data.total,error:data.error||null},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'C'})}).catch(()=>{});
                
                if (!data.success) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
                
                const records = data.items || data.records || [];
                const total = data.total || 0;
                
                if (records.length === 0) {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                    const thead = table.querySelector('thead');
                    const headerRow = thead ? thead.querySelector('tr') : null;
                    const columnCount = headerRow ? headerRow.querySelectorAll('th').length : 4;
                    
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="${columnCount}" style="text-align: center; padding: 40px; color: #718096;">
                                <div>–î–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
                                <div style="font-size: 12px; color: #a0aec0; margin-top: 10px;">
                                    ${total > 0 ? '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º' : '–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.'}
                                </div>
                            </td>
                        </tr>`;
                    document.getElementById('data-work-data-pagination').innerHTML = '';
                } else {
                    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    const allKeys = new Set();
                    records.forEach(record => {
                        if (record.payload_json) {
                            Object.keys(record.payload_json).forEach(key => allKeys.add(key));
                        }
                    });
                    const payloadKeys = Array.from(allKeys).sort();
                    
                    // –ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫: ID, –¢–∏–ø, –î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏, –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
                    const baseColumnCount = 4;
                    const totalColumnCount = baseColumnCount + payloadKeys.length;
                    
                    // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
                    let headerHTML = '<tr><th>ID</th><th>–¢–∏–ø</th>';
                    if (payloadKeys.length > 0) {
                        payloadKeys.forEach(key => {
                            headerHTML += `<th>${escapeHtml(key)}</th>`;
                        });
                    }
                    headerHTML += '<th>–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</th><th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th></tr>';
                    
                    const thead = table.querySelector('thead');
                    if (thead) {
                        thead.innerHTML = headerHTML;
                    }
                    
                    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
                    const rowsHTML = records.map(record => {
                        let rowHTML = `<tr>
                            <td>${record.id}</td>
                            <td>${escapeHtml(record.record_type || '-')}</td>`;
                        
                        if (payloadKeys.length > 0) {
                            payloadKeys.forEach(key => {
                                const value = record.payload_json && record.payload_json[key];
                                let displayValue = '-';
                                if (value !== null && value !== undefined) {
                                    if (typeof value === 'object') {
                                        displayValue = JSON.stringify(value);
                                    } else {
                                        displayValue = String(value);
                                    }
                                    if (displayValue.length > 100) {
                                        displayValue = displayValue.substring(0, 100) + '...';
                                    }
                                }
                                rowHTML += `<td title="${escapeHtml(String(value || ''))}">${escapeHtml(displayValue)}</td>`;
                            });
                        }
                        
                        const recordDate = record.record_date ? new Date(record.record_date).toLocaleDateString('ru-RU') : '-';
                        const createdDate = record.created_at ? new Date(record.created_at).toLocaleString('ru-RU') : '-';
                        rowHTML += `<td>${recordDate}</td><td>${createdDate}</td></tr>`;
                        return rowHTML;
                    }).join('');
                    
                    tbody.innerHTML = rowsHTML;
                    
                    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
                    renderDataWorkPagination(total, filters.limit, filters.offset);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                const thead = table.querySelector('thead');
                const headerRow = thead ? thead.querySelector('tr') : null;
                const columnCount = headerRow ? headerRow.querySelectorAll('th').length : 4;
                
                tbody.innerHTML = `
                    <tr>
                        <td colspan="${columnCount}" style="text-align: center; padding: 40px; color: #f56565;">
                            <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
                            <div style="font-size: 12px; color: #a0aec0; margin-top: 10px;">${escapeHtml(error.message)}</div>
                        </td>
                    </tr>`;
            } finally {
                if (overlay) overlay.classList.remove('active');
            }
        }
        
        function renderDataWorkPagination(total, limit, offset) {
            const paginationDiv = document.getElementById('data-work-data-pagination');
            if (!paginationDiv) return;
            
            const totalPages = Math.ceil(total / limit);
            const currentPage = Math.floor(offset / limit) + 1;
            
            if (totalPages <= 1) {
                paginationDiv.innerHTML = `<div style="text-align: center; padding: 10px; color: #718096;">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${total}</div>`;
                return;
            }
            
            let paginationHTML = `<div style="display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap;">`;
            paginationHTML += `<div style="padding: 5px 10px; color: #4a5568;">–í—Å–µ–≥–æ: ${total}</div>`;
            
            if (currentPage > 1) {
                paginationHTML += `<button class="btn-primary" onclick="dataWorkGoToPage(${currentPage - 1}, ${limit})" style="padding: 5px 15px;">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>`;
            }
            
            paginationHTML += `<div style="padding: 5px 10px; color: #4a5568;">–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}</div>`;
            
            if (currentPage < totalPages) {
                paginationHTML += `<button class="btn-primary" onclick="dataWorkGoToPage(${currentPage + 1}, ${limit})" style="padding: 5px 15px;">–°–ª–µ–¥—É—é—â–∞—è</button>`;
            }
            
            paginationHTML += `</div>`;
            paginationDiv.innerHTML = paginationHTML;
        }
        
        function dataWorkGoToPage(page, pageSize) {
            currentDataWorkOffset = (page - 1) * pageSize;
            loadDataWorkData();
        }
        
        function applyDataWorkWidgetsFilters() {
            // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–∏–¥–∂–µ—Ç–æ–≤
            console.log('–§–∏–ª—å—Ç—Ä—ã –≤–∏–¥–∂–µ—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
        }
        
        function resetDataWorkWidgetsFilters() {
            document.getElementById('data-work-widgets-data-type').value = 'all';
            document.getElementById('data-work-widgets-date-from').value = '';
            document.getElementById('data-work-widgets-date-to').value = '';
        }
        
        // ==================== –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ====================

        function updateScheduleFields() {
            const mode = document.getElementById('schedule_mode')?.value || 'daily';
            const dayWeekContainer = document.getElementById('schedule-day-of-week-container');
            const dayMonthContainer = document.getElementById('schedule-day-of-month-container');
            
            if (!dayWeekContainer || !dayMonthContainer) return;
            
            if (mode === 'weekly') {
                dayWeekContainer.style.display = 'block';
                dayMonthContainer.style.display = 'none';
            } else if (mode === 'monthly') {
                dayWeekContainer.style.display = 'none';
                dayMonthContainer.style.display = 'block';
            } else {
                dayWeekContainer.style.display = 'none';
                dayMonthContainer.style.display = 'none';
            }
        }
        
        function updateStopOnRepeatsFields() {
            const enabled = document.getElementById('stop_on_repeats_enabled')?.checked || false;
            const container = document.getElementById('stop_on_repeats_count_container');
            if (container) {
                container.style.display = enabled ? 'block' : 'none';
            }
        }
        
        async function loadSettings() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadSettings:start',message:'loadSettings –Ω–∞—á–∞—Ç–∞',data:{},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'E'})}).catch(()=>{});
            // #endregion
            const statusDiv = document.getElementById('settings-status');

            try {
                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                if (statusDiv) {
                    statusDiv.innerHTML = '';
                }

                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤–∫–ª–∞–¥–∫–∞ –≤–∏–¥–Ω–∞
                const settingsTab = document.getElementById('settings-tab');
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadSettings:tab',message:'–ü—Ä–æ–≤–µ—Ä–∫–∞ settingsTab',data:{found:!!settingsTab},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'D'})}).catch(()=>{});
                // #endregion
                if (settingsTab) {
                    settingsTab.style.display = 'block';
                    settingsTab.classList.add('active');
                }

                const response = await fetch('/api/settings/get');
                const data = await response.json();
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/5a9ef78c-7487-4c3d-ae97-9d1bd76885f4',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:loadSettings:response',message:'–û—Ç–≤–µ—Ç API settings',data:{success:data.success,hasSettings:!!data.settings,error:data.error||null},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'C'})}).catch(()=>{});
                // #endregion
                
                if (data.success && data.settings) {
                    const settings = data.settings;
                    
                    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    const setValue = (id, value) => {
                        const elem = document.getElementById(id);
                        if (elem) {
                            if (elem.type === 'checkbox') {
                                elem.checked = value === 'true' || value === true;
                            } else {
                                elem.value = value || '';
                            }
                        }
                    };
                    
                    const setChecked = (id, checked) => {
                        const elem = document.getElementById(id);
                        if (elem && elem.type === 'checkbox') {
                            elem.checked = checked === 'true' || checked === true;
                        }
                    };
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    setChecked('schedule_enabled', settings.schedule_enabled || 'false');
                    setValue('schedule_mode', settings.schedule_mode || 'daily');
                    setValue('schedule_time', settings.schedule_time || '02:00');
                    setValue('schedule_day_of_week', settings.schedule_day_of_week || '1');
                    setValue('schedule_day_of_month', settings.schedule_day_of_month || '1');
                    setValue('on_error', settings.on_error || 'pause');
                    setValue('retry_policy', settings.retry_policy || 'fixed');
                    setValue('retry_count', settings.retry_count || '3');
                    setValue('retry_delay_seconds', settings.retry_delay_seconds || '60');
                    setValue('throttle_seconds', settings.throttle_seconds || '10');
                    setChecked('process_only_zip', settings.process_only_zip !== 'false');
                    setValue('unknown_policy', settings.unknown_policy || 'skip');
                    setValue('sync_order', settings.sync_order || 'old_to_new');
                    setChecked('stop_on_repeats_enabled', settings.stop_on_repeats_enabled || 'false');
                    setValue('stop_on_repeats_count', settings.stop_on_repeats_count || '3');
                    setChecked('operational_log_enabled', settings.operational_log_enabled !== 'false');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π
                    if (typeof updateStopOnRepeatsFields === 'function') {
                        updateStopOnRepeatsFields();
                    }
                    if (typeof updateScheduleFields === 'function') {
                        updateScheduleFields();
                    }
                    if (typeof updateRuntimeLogVisibility === 'function') {
                        updateRuntimeLogVisibility();
                    }
                } else {
                    // API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –∏–ª–∏ –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const errorMsg = data.error || '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.';
                    if (statusDiv) {
                        statusDiv.innerHTML = '<div class="status info">' + escapeHtml(errorMsg) + '</div>';
                    }
                    console.warn('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', errorMsg);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    if (typeof updateScheduleFields === 'function') {
                        updateScheduleFields();
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                if (statusDiv) {
                    statusDiv.innerHTML = '<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + escapeHtml(error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.</div>';
                }
                
                // –í—Å–µ —Ä–∞–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                if (typeof updateScheduleFields === 'function') {
                    updateScheduleFields();
                }
            }
        }
        
        async function saveSettings() {
            try {
                const settings = {
                    schedule_enabled: document.getElementById('schedule_enabled').checked ? 'true' : 'false',
                    schedule_mode: document.getElementById('schedule_mode').value,
                    schedule_time: document.getElementById('schedule_time').value,
                    schedule_day_of_week: document.getElementById('schedule_day_of_week').value,
                    schedule_day_of_month: document.getElementById('schedule_day_of_month').value,
                    on_error: document.getElementById('on_error').value,
                    retry_policy: document.getElementById('retry_policy').value,
                    retry_count: document.getElementById('retry_count').value,
                    retry_delay_seconds: document.getElementById('retry_delay_seconds').value,
                    throttle_seconds: document.getElementById('throttle_seconds').value,
                    process_only_zip: document.getElementById('process_only_zip').checked ? 'true' : 'false',
                    unknown_policy: document.getElementById('unknown_policy').value,
                    operational_log_enabled: document.getElementById('operational_log_enabled').checked ? 'true' : 'false',
                    sync_order: document.getElementById('sync_order').value,
                    stop_on_repeats_enabled: document.getElementById('stop_on_repeats_enabled').checked ? 'true' : 'false',
                    stop_on_repeats_count: document.getElementById('stop_on_repeats_count').value
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∞
                updateRuntimeLogVisibility();
                
                const response = await fetch('/api/settings/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ settings })
                });
                
                const data = await response.json();
                if (data.success) {
                    const statusDiv = document.getElementById('settings-status');
                    statusDiv.innerHTML = '<div class="status success">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –û–±–Ω–æ–≤–ª–µ–Ω–æ: ' + new Date().toLocaleString('ru-RU') + '</div>';
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 5000);
                } else {
                    showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }
        
        async function resetSettings() {
            if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) return;
            try {
                // –û—á–∏—â–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç—ã
                const response = await fetch('/api/settings/get');
                const data = await response.json();
                if (data.success) {
                    const defaults = {
                        schedule_enabled: 'false',
                        schedule_mode: 'daily',
                        schedule_time: '02:00',
                        schedule_day_of_week: '1',
                        schedule_day_of_month: '1',
                        on_error: 'pause',
                        retry_policy: 'fixed',
                        retry_count: '3',
                        retry_delay_seconds: '60',
                        throttle_seconds: '10',
                        process_only_zip: 'true',
                        unknown_policy: 'skip',
                        operational_log_enabled: 'true'
                    };
                    
                    await fetch('/api/settings/save', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ settings: defaults })
                    });
                    
                    await loadSettings();
                    showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –¥–µ—Ñ–æ–ª—Ç–∞–º', 'success');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }
        
        // ==================== –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è ====================
        
        function renderPagination(currentPage, totalPages, pageSize, goToFuncName) {
            let html = '<div class="pagination">';
            
            // –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–≤–∞—è"
            if (currentPage > 0) {
                html += `<button class="btn-primary" onclick="${goToFuncName}(0, ${pageSize})">¬´ –ü–µ—Ä–≤–∞—è</button>`;
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            if (currentPage > 0) {
                html += `<button class="btn-primary" onclick="${goToFuncName}(${currentPage - 1}, ${pageSize})">‚Äπ –ù–∞–∑–∞–¥</button>`;
            }
            
            // –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
            const maxVisiblePages = 10;
            let startPage = Math.max(0, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages);
            
            if (endPage - startPage < maxVisiblePages) {
                startPage = Math.max(0, endPage - maxVisiblePages);
            }
            
            if (startPage > 0) {
                html += '<span>...</span>';
            }
            
            for (let i = startPage; i < endPage; i++) {
                if (i === currentPage) {
                    html += `<button class="btn-primary" style="opacity: 0.7;" disabled>${i + 1}</button>`;
                } else {
                    html += `<button class="btn-primary" onclick="${goToFuncName}(${i}, ${pageSize})">${i + 1}</button>`;
                }
            }
            
            if (endPage < totalPages) {
                html += '<span>...</span>';
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
            if (currentPage < totalPages - 1) {
                html += `<button class="btn-primary" onclick="${goToFuncName}(${currentPage + 1}, ${pageSize})">–í–ø–µ—Ä–µ–¥ ‚Ä∫</button>`;
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–ª–µ–¥–Ω—è—è"
            if (currentPage < totalPages - 1) {
                html += `<button class="btn-primary" onclick="${goToFuncName}(${totalPages - 1}, ${pageSize})">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</button>`;
            }
            
            // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            html += `
                <span style="margin-left: 15px;">
                    –°—Ç—Ä. <input type="number" class="page-input" id="page-input-${goToFuncName}" 
                           min="1" max="${totalPages}" value="${currentPage + 1}" 
                           onkeypress="if(event.key==='Enter') ${goToFuncName}(parseInt(this.value)-1, ${pageSize})">
                    –∏–∑ ${totalPages}
                    <button class="btn-primary" style="padding: 4px 8px; margin-left: 5px;" 
                            onclick="${goToFuncName}(parseInt(document.getElementById('page-input-${goToFuncName}').value)-1, ${pageSize})">–ü–µ—Ä–µ–π—Ç–∏</button>
                </span>
            `;
            
            html += '</div>';
            return html;
        }
        
        function parsedGoToPage(page, pageSize) {
            currentDbOffset = page * pageSize;
            currentDbLimit = pageSize;
            loadDatabase();
        }
        
        // ==================== –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –∞—Ä—Ö–∏–≤–∞ ====================
        
        let currentArchiveId = null;
        let currentDataViewerOffset = 0;
        let currentDataViewerLimit = 50;
        let currentDataViewerTotal = 0;
        
        function openDataViewer(archiveId) {
            currentArchiveId = archiveId;
            currentDataViewerOffset = 0;
            currentDataViewerLimit = parseInt(document.getElementById('data-viewer-page-size')?.value || 50);
            document.getElementById('data-viewer-modal').classList.add('active');
            document.getElementById('data-viewer-search').value = '';
            loadArchiveRecords(archiveId);
        }
        
        function closeDataViewer() {
            document.getElementById('data-viewer-modal').classList.remove('active');
            currentArchiveId = null;
        }
        
        function searchDataViewer() {
            currentDataViewerOffset = 0;
            loadArchiveRecords(currentArchiveId);
        }
        
        async function loadArchiveRecords(archiveId) {
            if (!archiveId) return;
            
            currentDataViewerLimit = parseInt(document.getElementById('data-viewer-page-size')?.value || 50);
            const search = document.getElementById('data-viewer-search')?.value || '';
            
            try {
                const params = new URLSearchParams({
                    limit: currentDataViewerLimit,
                    offset: currentDataViewerOffset,
                    search: search
                });
                
                const response = await fetch(`/api/db/archive/${archiveId}/records?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    currentDataViewerTotal = data.total;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    const archiveInfo = data.archive;
                    document.getElementById('data-viewer-title').textContent = 
                        `–î–∞–Ω–Ω—ã–µ –∞—Ä—Ö–∏–≤–∞ #${archiveId} (${archiveInfo.data_type || 'unknown'}) - ${data.total} –∑–∞–ø–∏—Å–µ–π`;
                    
                    // –°—Ç—Ä–æ–∏–º —Ç–∞–±–ª–∏—Ü—É
                    const contentDiv = document.getElementById('data-viewer-content');
                    
                    if (data.records.length === 0) {
                        contentDiv.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                        document.getElementById('data-viewer-pagination').innerHTML = '';
                        return;
                    }
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏
                    const columns = Object.keys(data.records[0]).filter(k => k !== 'id');
                    columns.unshift('id'); // ID –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–æ–π
                    
                    let tableHTML = '<table><thead><tr>';
                    columns.forEach(col => {
                        const displayName = col.replace('payload_', '');
                        tableHTML += `<th>${displayName}</th>`;
                    });
                    tableHTML += '<th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
                    
                    data.records.forEach(rec => {
                        tableHTML += '<tr>';
                        columns.forEach(col => {
                            let value = rec[col];
                            if (value === null || value === undefined) value = '-';
                            if (typeof value === 'object') value = JSON.stringify(value);
                            const displayValue = String(value).length > 50 
                                ? String(value).substring(0, 50) + '...' 
                                : value;
                            tableHTML += `<td class="expandable" title="${String(value).replace(/"/g, '&quot;')}" onclick="toggleCellExpand(this)">${displayValue}</td>`;
                        });
                        tableHTML += `<td><button class="btn-primary" style="padding: 4px 8px; font-size: 12px;" onclick="showRecordDetail(${rec.id})">–î–µ—Ç–∞–ª–∏</button></td>`;
                        tableHTML += '</tr>';
                    });
                    
                    tableHTML += '</tbody></table>';
                    contentDiv.innerHTML = tableHTML;
                    
                    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
                    const totalPages = Math.ceil(data.total / currentDataViewerLimit);
                    const currentPage = Math.floor(currentDataViewerOffset / currentDataViewerLimit);
                    
                    let paginationHTML = renderPagination(currentPage, totalPages, currentDataViewerLimit, 'dataViewerGoToPage');
                    paginationHTML += ` <span class="page-info">–ü–æ–∫–∞–∑–∞–Ω–æ ${currentDataViewerOffset + 1}-${Math.min(currentDataViewerOffset + data.records.length, data.total)} –∏–∑ ${data.total}</span>`;
                    
                    document.getElementById('data-viewer-pagination').innerHTML = paginationHTML;
                } else {
                    document.getElementById('data-viewer-content').innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${data.error}</p>`;
                }
            } catch (error) {
                document.getElementById('data-viewer-content').innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</p>`;
            }
        }
        
        function dataViewerGoToPage(page, pageSize) {
            currentDataViewerOffset = page * pageSize;
            currentDataViewerLimit = pageSize;
            loadArchiveRecords(currentArchiveId);
        }
        
        function toggleCellExpand(cell) {
            cell.classList.toggle('expanded');
            if (cell.classList.contains('expanded')) {
                cell.textContent = cell.getAttribute('title');
            } else {
                const fullText = cell.getAttribute('title');
                cell.textContent = fullText.length > 50 ? fullText.substring(0, 50) + '...' : fullText;
            }
        }
        
        // ==================== –î–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏ ====================
        
        async function showRecordDetail(recordId) {
            document.getElementById('record-detail-modal').classList.add('active');
            document.getElementById('record-detail-content').innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
            
            try {
                const response = await fetch(`/api/db/record/${recordId}`);
                const data = await response.json();
                
                if (data.success) {
                    const rec = data.record;
                    let html = '<div style="display: grid; gap: 15px;">';
                    
                    html += `<div><strong>ID:</strong> ${rec.id}</div>`;
                    html += `<div><strong>–¢–∏–ø:</strong> <span class="badge ${rec.record_type === 'plan' ? 'badge-info' : 'badge-success'}">${rec.record_type}</span></div>`;
                    html += `<div><strong>–ö–ª—é—á/GUID:</strong> ${rec.record_key || '-'}</div>`;
                    html += `<div><strong>–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏:</strong> ${rec.record_date || '-'}</div>`;
                    html += `<div><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> ${rec.created_at ? new Date(rec.created_at).toLocaleString('ru-RU') : '-'}</div>`;
                    html += `<div><strong>–ê—Ä—Ö–∏–≤:</strong> ${rec.archive_url || '-'}</div>`;
                    html += `<div><strong>XML —Ñ–∞–π–ª:</strong> ${rec.xml_file_name || '-'}</div>`;
                    
                    if (rec.payload_json && Object.keys(rec.payload_json).length > 0) {
                        html += '<div><strong>–î–∞–Ω–Ω—ã–µ (payload_json):</strong>';
                        html += '<pre style="background: #f7fafc; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 300px;">';
                        html += JSON.stringify(rec.payload_json, null, 2);
                        html += '</pre></div>';
                    }
                    
                    if (data.raw_xml) {
                        html += '<div><strong>–ò—Å—Ö–æ–¥–Ω—ã–π XML:</strong>';
                        html += '<pre style="background: #f7fafc; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 400px; font-size: 12px;">';
                        html += data.raw_xml.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        html += '</pre></div>';
                    }
                    
                    html += '</div>';
                    document.getElementById('record-detail-content').innerHTML = html;
                } else {
                    document.getElementById('record-detail-content').innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${data.error}</p>`;
                }
            } catch (error) {
                document.getElementById('record-detail-content').innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</p>`;
            }
        }
        
        function closeRecordDetail() {
            document.getElementById('record-detail-modal').classList.remove('active');
        }
        
        // ==================== –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö ====================
        
        let cleanupPreviewData = null;
        
        function updateCleanupDates() {
            const period = document.getElementById('cleanup-period').value;
            const customFrom = document.getElementById('cleanup-custom-from');
            const customTo = document.getElementById('cleanup-custom-to');
            
            if (period === 'custom') {
                customFrom.style.display = 'block';
                customTo.style.display = 'block';
            } else {
                customFrom.style.display = 'none';
                customTo.style.display = 'none';
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            document.getElementById('cleanup-preview').style.display = 'none';
            document.getElementById('cleanup-execute-btn').disabled = true;
            cleanupPreviewData = null;
        }
        
        async function previewCleanup() {
            const period = document.getElementById('cleanup-period').value;
            const target = document.getElementById('cleanup-target').value;
            const dateFrom = document.getElementById('cleanup-date-from').value;
            const dateTo = document.getElementById('cleanup-date-to').value;
            
            try {
                const response = await fetch('/api/cleanup/preview', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        period: period,
                        target: target,
                        date_from: dateFrom,
                        date_to: dateTo
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    cleanupPreviewData = data.preview;
                    const previewDiv = document.getElementById('cleanup-preview');
                    
                    let html = '<h5>–ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ:</h5><ul>';
                    const counts = data.preview.counts;
                    
                    if (counts.sync_runs !== undefined) html += `<li>–ó–∞–ø—É—Å–∫–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: <strong>${counts.sync_runs}</strong></li>`;
                    if (counts.operation_log !== undefined) html += `<li>–ó–∞–ø–∏—Å–µ–π –∂—É—Ä–Ω–∞–ª–∞: <strong>${counts.operation_log}</strong></li>`;
                    if (counts.zip_archives !== undefined) html += `<li>ZIP-–∞—Ä—Ö–∏–≤–æ–≤: <strong>${counts.zip_archives}</strong></li>`;
                    if (counts.xml_fragments !== undefined) html += `<li>XML-—Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤: <strong>${counts.xml_fragments}</strong></li>`;
                    if (counts.parsed_records !== undefined) html += `<li>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: <strong>${counts.parsed_records}</strong></li>`;
                    if (counts.plans_raw !== undefined) html += `<li>–ü–ª–∞–Ω–æ–≤ (raw): <strong>${counts.plans_raw}</strong></li>`;
                    if (counts.inspections_raw !== undefined) html += `<li>–ü—Ä–æ–≤–µ—Ä–æ–∫ (raw): <strong>${counts.inspections_raw}</strong></li>`;
                    
                    html += '</ul>';
                    html += `<p style="font-size: 12px; color: #718096;">–ü–µ—Ä–∏–æ–¥: ${new Date(data.preview.period.from).toLocaleString('ru-RU')} ‚Äî ${new Date(data.preview.period.to).toLocaleString('ru-RU')}</p>`;
                    
                    previewDiv.innerHTML = html;
                    previewDiv.style.display = 'block';
                    
                    // –†–∞–∑—Ä–µ—à–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —á—Ç–æ —É–¥–∞–ª—è—Ç—å
                    const hasData = Object.values(counts).some(v => v > 0);
                    document.getElementById('cleanup-execute-btn').disabled = !hasData;
                } else {
                    showStatus('–û—à–∏–±–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞: ' + data.error, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }
        
        async function executeCleanup() {
            if (!cleanupPreviewData) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä', 'error');
                return;
            }
            
            const counts = cleanupPreviewData.counts;
            let totalCount = Object.values(counts).reduce((a, b) => a + b, 0);
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${totalCount} –∑–∞–ø–∏—Å–µ–π? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`)) {
                return;
            }
            
            const period = document.getElementById('cleanup-period').value;
            const target = document.getElementById('cleanup-target').value;
            const dateFrom = document.getElementById('cleanup-date-from').value;
            const dateTo = document.getElementById('cleanup-date-to').value;
            
            try {
                const response = await fetch('/api/cleanup/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        period: period,
                        target: target,
                        date_from: dateFrom,
                        date_to: dateTo,
                        confirm: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let deletedMsg = '–£–¥–∞–ª–µ–Ω–æ: ';
                    Object.entries(data.deleted).forEach(([key, val]) => {
                        deletedMsg += `${key}: ${val}, `;
                    });
                    showStatus(deletedMsg.slice(0, -2), 'success');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                    document.getElementById('cleanup-preview').style.display = 'none';
                    document.getElementById('cleanup-execute-btn').disabled = true;
                    cleanupPreviewData = null;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    loadDatabase();
                    loadStatus();
                } else {
                    showStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + data.error, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }
        
        // ==================== –ü—Ä–æ—Å–º–æ—Ç—Ä XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ====================
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ currentXmlContentsOffset –∏ currentXmlContentsLimit –æ–±—ä—è–≤–ª–µ–Ω—ã –≤—ã—à–µ
        let currentXmlViewMode = 'raw';
        let currentXmlContent = null;
        
        function resetXmlContentsFilters() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
            resetDatabaseFilters();
            currentXmlContentsOffset = 0;
            loadXmlContents();
        }
        
        async function loadXmlContents() {
            debugLog('=== loadXmlContents –≤—ã–∑–≤–∞–Ω–∞ ===');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            const showLoading = !isDatabaseLoading['xml-contents'];
            isDatabaseLoading['xml-contents'] = true;
            
            const overlay = document.getElementById('database-xml-contents-loading-overlay');
            const loadingText = document.getElementById('database-xml-contents-loading-text');
            const tbody = document.getElementById('xml-contents-table');
            
            if (!tbody) {
                console.error('–¢–∞–±–ª–∏—Ü–∞ xml-contents-table –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                isDatabaseLoading['xml-contents'] = false;
                return;
            }
            
            if (showLoading && overlay) {
                overlay.classList.add('active');
                if (loadingText) loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞
            const dataType = document.getElementById('db-data-type')?.value || 'all';
            const dateFrom = document.getElementById('db-date-from')?.value || '';
            const dateTo = document.getElementById('db-date-to')?.value || '';
            const search = document.getElementById('db-search')?.value || '';
            const pageSize = parseInt(document.getElementById('db-page-size')?.value || 50);
            const sortBy = document.getElementById('db-sort-by')?.value || 'created_at';
            const sortOrder = document.getElementById('db-sort-order')?.value || 'desc';
            
            currentXmlContentsLimit = pageSize;
            currentDbOffset = currentXmlContentsOffset;
            
            try {
                const params = new URLSearchParams({
                    limit: currentXmlContentsLimit,
                    offset: currentXmlContentsOffset,
                    data_type: dataType,
                    date_from: dateFrom,
                    date_to: dateTo,
                    search: search,
                    sort_by: sortBy,
                    sort_order: sortOrder
                });
                
                debugLog('–ó–∞–ø—Ä–æ—Å XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', '/api/xml-contents?' + params.toString());
                const response = await fetch('/api/xml-contents?' + params);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                debugLog('–û—Ç–≤–µ—Ç API XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', data);
                
                if (data.success) {
                    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: items (–Ω–æ–≤—ã–π) –∏ contents (—Å—Ç–∞—Ä—ã–π)
                    const contents = data.items || data.contents || [];
                    const total = data.total || contents.length;
                    
                    if (contents.length === 0) {
                        debugLog('–ù–µ—Ç XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞. Total:', total);
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px; color: #718096;">
                                    <div style="margin-bottom: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>
                                    <div style="font-size: 12px; color: #a0aec0;">${data.message || '–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î: ' + total}</div>
                                </td>
                            </tr>`;
                        const paginationDiv = document.getElementById('xml-contents-pagination');
                        if (paginationDiv) paginationDiv.innerHTML = '';
                    } else {
                        debugLog('–û—Ç—Ä–∏—Å–æ–≤–∫–∞ XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', contents.length, '–∑–∞–ø–∏—Å–µ–π –∏–∑', total);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ –µ—Å—Ç—å total
                        if (total !== undefined && loadingText && showLoading) {
                            const loaded = contents.length;
                            const percent = Math.min(100, Math.round((loaded / total) * 100));
                            loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${loaded} –∏–∑ ${total} (${percent}%)`;
                        } else if (loadingText && showLoading) {
                            loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${contents.length} –∑–∞–ø–∏—Å–µ–π...`;
                        }
                        
                        tbody.innerHTML = contents.map(item => {
                            const typeBadge = item.data_type === 'plan' ? 'badge-info' : 'badge-success';
                            // status –º–æ–∂–µ—Ç –±—ã—Ç—å fragment_status –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ status
                            const itemStatus = item.status || item.fragment_status || 'unknown';
                            const statusClass = itemStatus === 'loaded' || itemStatus === 'processed' ? 'badge-success' :
                                              itemStatus === 'error' ? 'badge-error' : 'badge-warning';
                            const processedDate = item.processed_at ? new Date(item.processed_at).toLocaleString('ru-RU') : '-';
                            const sourceUrl = item.archive_url || item.archive_file_path || '-';
                            const sourceUrlDisplay = sourceUrl !== '-' ? escapeHtml(sourceUrl) : '-';
                            const fileName = item.file_name ? escapeHtml(item.file_name) : '-';
                            const xmlSizeKB = item.xml_size ? (item.xml_size / 1024).toFixed(2) + ' KB' : '-';
                            
                            return `
                                <tr>
                                    <td>${escapeHtml(item.id || '-')}</td>
                                    <td><span class="badge ${typeBadge}">${escapeHtml(item.data_type || '-')}</span></td>
                                    <td title="${fileName}">${fileName}</td>
                                    <td title="${sourceUrlDisplay}">${sourceUrlDisplay}</td>
                                    <td>${xmlSizeKB}</td>
                                    <td>${processedDate}</td>
                                    <td><span class="badge ${statusClass}">${escapeHtml(itemStatus)}</span></td>
                                    <td>
                                        <button class="btn-primary" onclick="openXmlViewer('${escapeHtml(item.id)}')" style="padding: 4px 8px; font-size: 12px;">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                        
                        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
                        const totalPages = Math.ceil(total / currentXmlContentsLimit);
                        const currentPage = Math.floor(currentXmlContentsOffset / currentXmlContentsLimit);
                        const paginationDiv = document.getElementById('xml-contents-pagination');
                        if (paginationDiv) {
                            if (totalPages > 1) {
                                let paginationHTML = renderPagination(currentPage, totalPages, currentXmlContentsLimit, 'xmlContentsGoToPage');
                                paginationHTML += ` <span class="page-info">–í—Å–µ–≥–æ: ${total} XML</span>`;
                                paginationDiv.innerHTML = paginationHTML;
                            } else {
                                paginationDiv.innerHTML = `<span class="page-info">–í—Å–µ–≥–æ: ${total} XML</span>`;
                            }
                        }
                        debugLog('XML –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω, —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', tbody.querySelectorAll('tr').length);
                        console.log('XML –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω, —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', tbody.querySelectorAll('tr').length);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É
                        const subTabXml = document.getElementById('database-xml-contents');
                        if (subTabXml) {
                            const isActive = subTabXml.classList.contains('active');
                            console.log('–í–∫–ª–∞–¥–∫–∞ database-xml-contents –∏–º–µ–µ—Ç –∫–ª–∞—Å—Å active:', isActive);
                            if (!isActive) {
                                console.warn('–í–∫–ª–∞–¥–∫–∞ xml-contents –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞! –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º...');
                                subTabXml.classList.add('active');
                                const tabBtn = document.getElementById('db-tab-xml-contents');
                                if (tabBtn) tabBtn.classList.add('active');
                            }
                        }
                    }
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #e53e3e;">
                                <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div style="font-size: 12px;">${escapeHtml(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}</div>
                            </td>
                        </tr>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ XML –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #e53e3e;">
                            <div style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div style="font-size: 12px;">${escapeHtml(error.message)}</div>
                        </td>
                    </tr>`;
            } finally {
                isDatabaseLoading['xml-contents'] = false;
                const overlay = document.getElementById('database-xml-contents-loading-overlay');
                if (overlay) {
                    overlay.classList.remove('active');
                    debugLog('Overlay —Å–∫—Ä—ã—Ç –¥–ª—è xml-contents');
                }
            }
        }
        
        function xmlContentsGoToPage(page, pageSize) {
            currentXmlContentsOffset = page * pageSize;
            currentXmlContentsLimit = pageSize;
            loadXmlContents();
        }
        
        async function openXmlViewer(contentId) {
            document.getElementById('xml-viewer-modal').classList.add('active');
            document.getElementById('xml-viewer-content').innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
            currentXmlViewMode = 'raw';
            document.getElementById('xml-viewer-search').value = '';
            
            try {
                const response = await fetch(`/api/xml-contents/${contentId}`);
                const data = await response.json();
                
                if (data.success) {
                    currentXmlContent = data.content;
                    document.getElementById('xml-viewer-title').textContent = 
                        `–ü—Ä–æ—Å–º–æ—Ç—Ä XML: ${data.content.file_name || contentId} (${data.content.data_type})`;
                    setXmlViewMode('raw');
                } else {
                    document.getElementById('xml-viewer-content').innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞: ${data.error}</p>`;
                }
            } catch (error) {
                document.getElementById('xml-viewer-content').innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</p>`;
            }
        }
        
        function closeXmlViewer() {
            document.getElementById('xml-viewer-modal').classList.remove('active');
            currentXmlContent = null;
        }
        
        function setXmlViewMode(mode) {
            currentXmlViewMode = mode;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            ['raw', 'tree', 'table'].forEach(m => {
                const btn = document.getElementById(`xml-view-mode-${m}`);
                if (btn) {
                    if (m === mode) {
                        btn.style.opacity = '0.7';
                        btn.disabled = true;
                    } else {
                        btn.style.opacity = '1';
                        btn.disabled = false;
                    }
                }
            });
            
            if (!currentXmlContent || !currentXmlContent.xml_content) {
                return;
            }
            
            renderXmlContent(mode, currentXmlContent.xml_content);
        }
        
        function renderXmlContent(mode, xmlContent) {
            const container = document.getElementById('xml-viewer-content');
            
            if (mode === 'raw') {
                // Pretty print XML
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
                    const serializer = new XMLSerializer();
                    const prettyXml = formatXml(xmlContent);
                    container.innerHTML = `<pre style="white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', monospace; font-size: 12px; margin: 0;">${escapeHtml(prettyXml)}</pre>`;
                } catch (e) {
                    container.innerHTML = `<pre style="white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', monospace; font-size: 12px; margin: 0;">${escapeHtml(xmlContent)}</pre>`;
                }
            } else if (mode === 'tree') {
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
                    container.innerHTML = renderXmlTree(xmlDoc.documentElement, 0);
                } catch (e) {
                    container.innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML: ${e.message}</p>`;
                }
            } else if (mode === 'table') {
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
                    const fields = extractXmlFields(xmlDoc.documentElement);
                    renderXmlTable(container, fields);
                } catch (e) {
                    container.innerHTML = `<p style="color: red;">–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML: ${e.message}</p>`;
                }
            }
        }
        
        function formatXml(xml) {
            let formatted = '';
            let indent = 0;
            const tab = '  ';
            xml.split(/>\s*</).forEach(node => {
                if (node.match(/^\/\w/)) indent--;
                formatted += tab.repeat(Math.max(0, indent)) + '<' + node + '>\r\n';
                if (node.match(/^<?\w[^>]*[^\/]$/) && !node.startsWith('input')) indent++;
            });
            return formatted.substring(1, formatted.length - 3);
        }
        
        // escapeHtml —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤—ã—à–µ
        
        function renderXmlTree(node, depth) {
            let html = '<div style="margin-left: ' + (depth * 20) + 'px; margin-bottom: 5px;">';
            html += `<strong style="color: #667eea;">&lt;${node.nodeName}&gt;</strong>`;
            
            // –ê—Ç—Ä–∏–±—É—Ç—ã
            if (node.attributes && node.attributes.length > 0) {
                html += ' <span style="color: #ed8936;">';
                Array.from(node.attributes).forEach(attr => {
                    html += `${attr.name}="${attr.value}" `;
                });
                html += '</span>';
            }
            
            // –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            if (node.childNodes.length === 1 && node.firstChild.nodeType === 3) {
                html += ` <span style="color: #48bb78;">${escapeHtml(node.textContent.trim())}</span>`;
                html += ` <strong style="color: #667eea;">&lt;/${node.nodeName}&gt;</strong>`;
                html += '</div>';
                return html;
            }
            
            html += '</div>';
            
            // –î–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            Array.from(node.childNodes).forEach(child => {
                if (child.nodeType === 1) {
                    html += renderXmlTree(child, depth + 1);
                }
            });
            
            html += `<div style="margin-left: ${depth * 20}px;"><strong style="color: #667eea;">&lt;/${node.nodeName}&gt;</strong></div>`;
            
            return html;
        }
        
        function extractXmlFields(node, path = '') {
            const fields = [];
            const currentPath = path ? `${path}/${node.nodeName}` : node.nodeName;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã
            if (node.attributes && node.attributes.length > 0) {
                Array.from(node.attributes).forEach(attr => {
                    fields.push({
                        path: `${currentPath}@${attr.name}`,
                        value: attr.value
                    });
                });
            }
            
            // –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            if (node.childNodes.length === 1 && node.firstChild.nodeType === 3) {
                fields.push({
                    path: currentPath,
                    value: node.textContent.trim()
                });
                return fields;
            }
            
            // –î–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            Array.from(node.childNodes).forEach(child => {
                if (child.nodeType === 1) {
                    fields.push(...extractXmlFields(child, currentPath));
                }
            });
            
            return fields;
        }
        
        function renderXmlTable(container, fields) {
            let html = '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border: 1px solid #e2e8f0; padding: 8px; background: #f7fafc;">–ü—É—Ç—å</th><th style="border: 1px solid #e2e8f0; padding: 8px; background: #f7fafc;">–ó–Ω–∞—á–µ–Ω–∏–µ</th></tr></thead><tbody>';
            fields.forEach(field => {
                const value = field.value.length > 200 ? field.value.substring(0, 200) + '...' : field.value;
                html += `<tr><td style="border: 1px solid #e2e8f0; padding: 8px; font-family: monospace;">${escapeHtml(field.path)}</td><td style="border: 1px solid #e2e8f0; padding: 8px;">${escapeHtml(value)}</td></tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function searchInXml() {
            const searchTerm = document.getElementById('xml-viewer-search').value.toLowerCase();
            if (!searchTerm || !currentXmlContent) return;
            
            const container = document.getElementById('xml-viewer-content');
            const content = container.innerHTML;
            if (!content) return;
            
            // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            const highlighted = content.replace(regex, '<mark style="background: yellow;">$1</mark>');
            container.innerHTML = highlighted;
        }
        
        function copyXmlContent() {
            if (!currentXmlContent || !currentXmlContent.xml_content) return;
            
            navigator.clipboard.writeText(currentXmlContent.xml_content).then(() => {
                showStatus('XML —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(err => {
                showStatus('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message, 'error');
            });
        }
        
        // ==================== –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π ====================
        
        let runtimeLogEvents = [];
        let runtimeLogExpanded = false;
        let runtimeLogMinimized = false;
        
        function toggleRuntimeLog() {
            if (runtimeLogMinimized) {
                restoreRuntimeLog();
                return;
            }
            
            const widget = document.getElementById('runtime-log-widget');
            const body = document.getElementById('runtime-log-body');
            const btn = document.getElementById('runtime-log-expand-btn');
            const icon = document.getElementById('runtime-log-toggle-icon');
            
            runtimeLogExpanded = !runtimeLogExpanded;
            
            if (runtimeLogExpanded) {
                widget.classList.remove('collapsed');
                widget.classList.add('expanded');
                body.classList.remove('collapsed');
                btn.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                icon.textContent = '‚ñ≤';
            } else {
                widget.classList.remove('expanded');
                widget.classList.add('collapsed');
                body.classList.add('collapsed');
                btn.textContent = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';
                icon.textContent = '‚ñº';
            }
        }
        
        function minimizeRuntimeLog(event) {
            if (event) event.stopPropagation();
            const widget = document.getElementById('runtime-log-widget');
            const minimized = document.getElementById('runtime-log-minimized');
            
            widget.style.display = 'none';
            minimized.style.display = 'flex';
            runtimeLogMinimized = true;
        }
        
        function restoreRuntimeLog() {
            const widget = document.getElementById('runtime-log-widget');
            const minimized = document.getElementById('runtime-log-minimized');
            
            widget.style.display = '';
            minimized.style.display = 'none';
            runtimeLogMinimized = false;
        }
        
        function clearRuntimeLog(event) {
            if (event) event.stopPropagation();
            // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∞
            // –±–µ–∑ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ –≤ –ë–î
            runtimeLogEvents = [];
            updateRuntimeLogDisplay();
        }
        
        function updateRuntimeLogVisibility() {
            const enabled = document.getElementById('operational_log_enabled');
            const widget = document.getElementById('runtime-log-widget');
            const minimized = document.getElementById('runtime-log-minimized');
            
            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const shouldShow = !enabled || enabled.checked;
            
            if (shouldShow) {
                if (!runtimeLogMinimized) {
                    if (widget) widget.style.display = '';
                } else {
                    if (minimized) minimized.style.display = 'flex';
                }
            } else {
                if (widget) widget.style.display = 'none';
                if (minimized) minimized.style.display = 'none';
            }
        }
        
        async function loadRuntimeStatus() {
            try {
                const response = await fetch('/api/runtime/status');
                const data = await response.json();
                
                if (data.success) {
                    updateRuntimeLogStatus(data);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ runtime —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        async function loadRuntimeEvents() {
            try {
                const response = await fetch('/api/runtime/events?limit=50');
                const data = await response.json();
                
                if (data.success) {
                    runtimeLogEvents = data.events.reverse(); // –û–±—Ä–∞—â–∞–µ–º –¥–ª—è —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞
                    updateRuntimeLogDisplay();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ runtime —Å–æ–±—ã—Ç–∏–π:', error);
            }
        }
        
        function updateRuntimeLogStatus(status) {
            const indicator = document.getElementById('runtime-log-status-indicator');
            const indicatorMinimized = document.getElementById('runtime-log-status-indicator-minimized');
            const operationDiv = document.getElementById('runtime-log-current-operation');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
            const stateClass = 'runtime-log-status-indicator ' + (status.state || 'idle');
            if (indicator) indicator.className = stateClass;
            if (indicatorMinimized) indicatorMinimized.className = stateClass;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
            const operation = status.current_operation || '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π';
            operationDiv.textContent = `–¢–µ–∫—É—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: ${operation}`;
            
            if (status.progress) {
                const progress = status.progress;
                let progressText = '';
                if (progress.files_processed !== undefined) {
                    progressText += `–§–∞–π–ª–æ–≤: ${progress.files_processed}`;
                }
                if (progress.records_loaded !== undefined) {
                    progressText += progressText ? `, –ó–∞–ø–∏—Å–µ–π: ${progress.records_loaded}` : `–ó–∞–ø–∏—Å–µ–π: ${progress.records_loaded}`;
                }
                if (progressText) {
                    operationDiv.textContent += ` (${progressText})`;
                }
            }
        }
        
        function updateRuntimeLogDisplay() {
            const eventsDiv = document.getElementById('runtime-log-events');
            
            if (runtimeLogEvents.length === 0) {
                eventsDiv.innerHTML = '<p style="color: #718096; font-size: 12px; margin: 0;">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</p>';
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–≤ —Å–≤–µ—Ä–Ω—É—Ç–æ–º –≤–∏–¥–µ - 3, –≤ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º - –≤—Å–µ)
            const eventsToShow = runtimeLogExpanded ? runtimeLogEvents : runtimeLogEvents.slice(-3);
            
            eventsDiv.innerHTML = eventsToShow.map(event => {
                const time = event.timestamp ? new Date(event.timestamp).toLocaleTimeString('ru-RU') : '';
                const levelClass = event.level || 'INFO';
                const message = event.message || '';
                
                return `
                    <div class="runtime-log-event ${levelClass}">
                        <span class="runtime-log-event-time">${time}</span>
                        <span class="runtime-log-event-message">${escapeHtml(message)}</span>
                    </div>
                `;
            }).join('');
            
            // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º –≤–∏–¥–µ
            if (runtimeLogExpanded) {
                eventsDiv.scrollTop = eventsDiv.scrollHeight;
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        loadStatus();
        loadRuns();
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
        updateRuntimeLogVisibility();
        loadSettings(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–æ–≥–∞
        loadRuntimeStatus();
        loadRuntimeEvents();
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –∏ runtime –ª–æ–≥, –Ω–æ –ù–ï –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü
        // –¢–∞–±–ª–∏—Ü—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–º–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∏, —Ñ–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è)
        refreshInterval = setInterval(() => {
            loadStatus();
            loadRuntimeStatus();
            loadRuntimeEvents();
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –∞–∫—Ç–∏–≤–Ω—ã, –Ω–æ —Å –±–æ–ª—å—à–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –∏ –±–µ–∑ –ø–æ–∫–∞–∑–∞ "–ó–∞–≥—Ä—É–∑–∫–∞..."
            if (document.getElementById('runs-tab').classList.contains('active')) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–∑ –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                loadRuns();
            }
            if (document.getElementById('logs-tab').classList.contains('active')) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–∑ –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (overlay —Å–∫—Ä—ã—Ç)
                loadLogs();
            }
            // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º loadDatabase() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - —Ç–æ–ª—å–∫–æ –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        }, 10000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ (–≤–º–µ—Å—Ç–æ 2)
    </script>
</body>
</html>


